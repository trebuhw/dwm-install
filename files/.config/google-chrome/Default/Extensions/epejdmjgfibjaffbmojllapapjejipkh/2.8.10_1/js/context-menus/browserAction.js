!function(){const menuItems=document.querySelectorAll(".context-menu-link"),menu=document.querySelector(".context-menu"),divider=document.querySelector(".context-divider"),active="context-menu--active",CONTEXT_TITLES={OPEN:chrome.i18n.getMessage("CONTEXT_OPEN"),OPEN_NEW_TAB:chrome.i18n.getMessage("CONTEXT_OPEN_NEW_TAB"),OPEN_NEW_WINDOW:chrome.i18n.getMessage("CONTEXT_OPEN_NEW_WINDOW"),EDIT:chrome.i18n.getMessage("CONTEXT_EDIT"),DELETE:chrome.i18n.getMessage("CONTEXT_DELETE"),CREATE_FOLDER:chrome.i18n.getMessage("POPUP_ADD_NEW_FOLDER"),OPEN_ALL:chrome.i18n.getMessage("CONTEXT_OPEN_ALL"),DELETE_ALL:chrome.i18n.getMessage("CONTEXT_DELETE_ALL"),DELETE_TAB:chrome.i18n.getMessage("CONTEXT_DELETE_TAB")},CONTEXT_BOOKMARK=["EDIT","DELETE","OPEN","OPEN_NEW_TAB","OPEN_NEW_WINDOW","CREATE_FOLDER"],CONTEXT_FOLDER=["EDIT","DELETE","CREATE_FOLDER"],CONTEXT_GLOBAL=["CREATE_FOLDER"],CONTEXT_TAB_MAIN=["OPEN_ALL","DELETE_ALL"],CONTEXT_TAB_SUB=["OPEN","OPEN_NEW_TAB","OPEN_NEW_WINDOW","DELETE_TAB"];let bookmarkInContext;const positionMenu=e=>{const{x:x,y:y}=(e=>{let x=0,y=0;return e.pageX||e.pageY?(x=e.pageX,y=e.pageY):(e.clientX||e.clientY)&&(x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:x,y:y}})(e),menuX=Math.min(x,window.innerWidth-(menu.offsetWidth+4)),menuY=Math.min(y,window.innerHeight-(menu.offsetHeight+4));menu.style.left=`${menuX+1}px`,menu.style.top=`${menuY+1}px`},showMenu=(isMouse=!0)=>{if(document.querySelector(".syncPage").classList.contains("syncing"))return;menu.classList.add(active),Array.from(menu.querySelectorAll("ul li a")).forEach((el=>{el.setAttribute("tabindex",-1),el.classList.contains("active")&&el.parentNode.setAttribute("tabindex",0)})),!isMouse&&menu.querySelector("ul li a.active").parentNode.focus();const lastActive=Array.from(menu.querySelectorAll("ul li a.active")).slice(-1)[0];lastActive&&(lastActive.parentNode.onblur=hideMenu)},hideMenu=()=>{menu.classList.remove(active),Array.from(menu.querySelectorAll("ul li")).forEach((el=>el.setAttribute("tabindex",-1)))},addClickListener=item=>{item.addEventListener("click",(e=>{const{action:action}=e.target.dataset;switch(document.dispatchEvent(new CustomEvent("analytics",{detail:{action:`CONTEXT_MENU-${action}`,event:e}})),action){case"OPEN":case"OPEN_NEW_TAB":case"OPEN_NEW_WINDOW":((urls=[],type="OPEN_NEW_TAB")=>{switch(type){case"OPEN":{const[url]=urls;updateTabInCurrentWindow(url);break}case"OPEN_NEW_TAB":createTabInCurrentWindow(...urls);break;case"OPEN_NEW_WINDOW":createTabsInWindow(urls).then((()=>window.close()))}})([bookmarkInContext.dataset.url],action);break;case"EDIT":onEditClick(e,bookmarkInContext);break;case"DELETE":onDeleteConfirm(e,bookmarkInContext);break;case"CREATE_FOLDER":CreateModal.visible=!0;break;case"OPEN_ALL":var tab_entries=document.getElementById(bookmarkInContext.id).parentElement.querySelectorAll(".tab_entry");for(tab of tab_entries)createTabInCurrentWindow(tab.dataset.url);break;case"DELETE_ALL":case"DELETE_TAB":onTabDeleteConfirm(e,bookmarkInContext)}}))},buildMenuItems=()=>{menuItems.forEach((item=>{addClickListener(item),(item=>{item.innerHTML=CONTEXT_TITLES[item.dataset.action]})(item)}))};document.addEventListener("click",hideMenu),bookmarksData.addEventListener("scroll",hideMenu),buildMenuItems(),document.addEventListener("dblclick",(e=>{let elem=e.target;if(elem.classList.contains("tab_device")){var tab_entries=document.getElementById(elem.id).parentElement.querySelectorAll(".tab_entry");for(tab of tab_entries)"block"==tab.parentElement.style.display?(tab.style.display="none",tab.parentElement.style.display="none"):(tab.style.display="block",tab.parentElement.style.display="block")}})),document.addEventListener("contextmenu",(e=>{let elem=e.target,isTarget=!1;for(;elem.parentNode;){if(elem.classList.contains("bookmarksData")){isTarget=!0,divider.style.display="none",menuItems.forEach((item=>{item.style.display=CONTEXT_GLOBAL.some((action=>action===item.dataset.action))?"block":"none"}));break}if(elem.classList.contains("bookmark_entry")){isTarget=!0,divider.style.display="block",bookmarkInContext=elem,menuItems.forEach((item=>{item.style.display=CONTEXT_BOOKMARK.some((action=>action===item.dataset.action))?"block":"none"}));break}if(elem.classList.contains("bookmark_folder")){isTarget=!0,divider.style.display="none",bookmarkInContext=elem,menuItems.forEach((item=>{item.style.display=CONTEXT_FOLDER.some((action=>action===item.dataset.action))?"block":"none"}));break}if(elem.classList.contains("bookmarkListTitle")){isTarget=!0,divider.style.display="none",bookmarkInContext=elem,menuItems.forEach((item=>{item.style.display=CONTEXT_GLOBAL.some((action=>action===item.dataset.action))?"block":"none"}));break}if(elem.classList.contains("tab_device")){isTarget=!0,divider.style.display="none",bookmarkInContext=elem,menuItems.forEach((item=>{item.style.display=CONTEXT_TAB_MAIN.some((action=>action===item.dataset.action))?"block":"none"}));break}if(elem.classList.contains("tab_entry")){isTarget=!0,divider.style.display="block",bookmarkInContext=elem,menuItems.forEach((item=>{item.style.display=CONTEXT_TAB_SUB.some((action=>action===item.dataset.action))?"block":"none"}));break}elem=elem.parentNode}e.ctrlKey||e.preventDefault(),isTarget&&(positionMenu(e),hideMenu(),setTimeout(showMenu,50))}))}();