/*!
 * jquery.fancytree.js
 * Tree view control with support for lazy loading and much more.
 * https://github.com/mar10/fancytree/
 *
 * Copyright (c) 2008-2018, Martin Wendt (http://wwWendt.de)
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version @VERSION
 * @date @DATE
 */
!function(factory){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree.ui-deps"],factory):"object"==typeof module&&module.exports?(require("./jquery.fancytree.ui-deps"),module.exports=factory(require("jquery"))):factory(jQuery)}((function($){"use strict";if(!$.ui||!$.ui.fancytree){var i,attr,FT=null,TEST_IMG=new RegExp(/\.|\//),REX_HTML=/[&<>"'\/]/g,REX_TOOLTIP=/[<>"'\/]/g,ENTITY_MAP={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},IGNORE_KEYCODES={16:!0,17:!0,18:!0},SPECIAL_KEYCODES={8:"backspace",9:"tab",10:"return",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},MOUSE_BUTTONS={0:"",1:"left",2:"middle",3:"right"},CLASS_ATTRS="active expanded focus folder lazy radiogroup selected unselectable unselectableIgnore".split(" "),CLASS_ATTR_MAP={},TREE_ATTRS="columns types".split(" "),NODE_ATTRS="checkbox expanded extraClasses folder icon iconTooltip key lazy partsel radiogroup refKey selected statusNodeType title tooltip type unselectable unselectableIgnore unselectableStatus".split(" "),NODE_ATTR_MAP={},NODE_ATTR_LOWERCASE_MAP={},NONE_NODE_DATA_MAP={active:!0,children:!0,data:!0,focus:!0};for(i=0;i<CLASS_ATTRS.length;i++)CLASS_ATTR_MAP[CLASS_ATTRS[i]]=!0;for(i=0;i<NODE_ATTRS.length;i++)attr=NODE_ATTRS[i],NODE_ATTR_MAP[attr]=!0,attr!==attr.toLowerCase()&&(NODE_ATTR_LOWERCASE_MAP[attr.toLowerCase()]=attr);return _assert($.ui,"Fancytree requires jQuery UI (http://jqueryui.com)"),Date.now||(Date.now=function(){return(new Date).getTime()}),FancytreeNode.prototype={_findDirectChild:function(ptr){var i,l,cl=this.children;if(cl)if("string"==typeof ptr){for(i=0,l=cl.length;i<l;i++)if(cl[i].key===ptr)return cl[i]}else{if("number"==typeof ptr)return this.children[ptr];if(ptr.parent===this)return ptr}return null},_setChildren:function(children){_assert(children&&(!this.children||0===this.children.length),"only init supported"),this.children=[];for(var i=0,l=children.length;i<l;i++)this.children.push(new FancytreeNode(this,children[i]))},addChildren:function(children,insertBefore){var i,l,pos,firstNode,origFirstChild=this.getFirstChild(),origLastChild=this.getLastChild(),nodeList=[];for($.isPlainObject(children)&&(children=[children]),this.children||(this.children=[]),i=0,l=children.length;i<l;i++)nodeList.push(new FancytreeNode(this,children[i]));if(firstNode=nodeList[0],null==insertBefore?this.children=this.children.concat(nodeList):(insertBefore=this._findDirectChild(insertBefore),_assert((pos=$.inArray(insertBefore,this.children))>=0,"insertBefore must be an existing child"),this.children.splice.apply(this.children,[pos,0].concat(nodeList))),origFirstChild&&!insertBefore){for(i=0,l=nodeList.length;i<l;i++)nodeList[i].render();origFirstChild!==this.getFirstChild()&&origFirstChild.renderStatus(),origLastChild!==this.getLastChild()&&origLastChild.renderStatus()}else(!this.parent||this.parent.ul||this.tr)&&this.render();return 3===this.tree.options.selectMode&&this.fixSelection3FromEndNodes(),this.triggerModifyChild("add",1===nodeList.length?nodeList[0]:null),firstNode},addClass:function(className){return this.toggleClass(className,!0)},addNode:function(node,mode){switch(void 0!==mode&&"over"!==mode||(mode="child"),mode){case"after":return this.getParent().addChildren(node,this.getNextSibling());case"before":return this.getParent().addChildren(node,this);case"firstChild":var insertBefore=this.children?this.children[0]:null;return this.addChildren(node,insertBefore);case"child":case"over":return this.addChildren(node)}_assert(!1,"Invalid mode: "+mode)},addPagingNode:function(node,mode){var i,n;if(mode=mode||"child",!1!==node)return node=$.extend({title:this.tree.options.strings.moreData,statusNodeType:"paging",icon:!1},node),this.partload=!0,this.addNode(node,mode);for(i=this.children.length-1;i>=0;i--)"paging"===(n=this.children[i]).statusNodeType&&this.removeChild(n);this.partload=!1},appendSibling:function(node){return this.addNode(node,"after")},applyPatch:function(patch){if(null===patch)return this.remove(),_getResolvedPromise(this);var name,v,IGNORE_MAP={children:!0,expanded:!0,parent:!0};for(name in patch)v=patch[name],IGNORE_MAP[name]||$.isFunction(v)||(NODE_ATTR_MAP[name]?this[name]=v:this.data[name]=v);return patch.hasOwnProperty("children")&&(this.removeChildren(),patch.children&&this._setChildren(patch.children)),this.isVisible()&&(this.renderTitle(),this.renderStatus()),patch.hasOwnProperty("expanded")?this.setExpanded(patch.expanded):_getResolvedPromise(this)},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(node,mode,map){return node.addNode(this.toDict(!0,map),mode)},countChildren:function(deep){var i,l,n,cl=this.children;if(!cl)return 0;if(n=cl.length,!1!==deep)for(i=0,l=n;i<l;i++)n+=cl[i].countChildren();return n},debug:function(msg){this.tree.options.debugLevel>=4&&(Array.prototype.unshift.call(arguments,this.toString()),consoleApply("log",arguments))},discard:function(){return this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead."),this.resetLazy()},discardMarkup:function(includeSelf){var fn=includeSelf?"nodeRemoveMarkup":"nodeRemoveChildMarkup";this.tree._callHook(fn,this)},error:function(msg){this.options.debugLevel>=1&&(Array.prototype.unshift.call(arguments,this.toString()),consoleApply("error",arguments))},findAll:function(match){match=$.isFunction(match)?match:_makeNodeTitleMatcher(match);var res=[];return this.visit((function(n){match(n)&&res.push(n)})),res},findFirst:function(match){match=$.isFunction(match)?match:_makeNodeTitleMatcher(match);var res=null;return this.visit((function(n){if(match(n))return res=n,!1})),res},_changeSelectStatusAttrs:function(state){var changed=!1,opts=this.tree.options,unselectable=FT.evalOption("unselectable",this,this,opts,!1),unselectableStatus=FT.evalOption("unselectableStatus",this,this,opts,void 0);switch(unselectable&&null!=unselectableStatus&&(state=unselectableStatus),state){case!1:changed=this.selected||this.partsel,this.selected=!1,this.partsel=!1;break;case!0:changed=!this.selected||!this.partsel,this.selected=!0,this.partsel=!0;break;case void 0:changed=this.selected||!this.partsel,this.selected=!1,this.partsel=!0;break;default:_assert(!1,"invalid state: "+state)}return changed&&this.renderStatus(),changed},fixSelection3AfterClick:function(callOpts){var flag=this.isSelected();this.visit((function(node){node._changeSelectStatusAttrs(flag)})),this.fixSelection3FromEndNodes(callOpts)},fixSelection3FromEndNodes:function(callOpts){var opts=this.tree.options;_assert(3===opts.selectMode,"expected selectMode 3"),function _walk(node){var i,l,child,s,state,allSelected,someSelected,unselState,children=node.children;if(children&&children.length){for(allSelected=!0,someSelected=!1,i=0,l=children.length;i<l;i++)s=_walk(child=children[i]),FT.evalOption("unselectableIgnore",child,child,opts,!1)||(!1!==s&&(someSelected=!0),!0!==s&&(allSelected=!1));state=!!allSelected||!!someSelected&&void 0}else state=null==(unselState=FT.evalOption("unselectableStatus",node,node,opts,void 0))?!!node.selected:!!unselState;return node._changeSelectStatusAttrs(state),state}(this),this.visitParents((function(node){var i,l,child,state,unselState,children=node.children,allSelected=!0,someSelected=!1;for(i=0,l=children.length;i<l;i++)child=children[i],FT.evalOption("unselectableIgnore",child,child,opts,!1)||(((state=null==(unselState=FT.evalOption("unselectableStatus",child,child,opts,void 0))?!!child.selected:!!unselState)||child.partsel)&&(someSelected=!0),state||(allSelected=!1));state=!!allSelected||!!someSelected&&void 0,node._changeSelectStatusAttrs(state)}))},fromDict:function(dict){for(var name in dict)NODE_ATTR_MAP[name]?this[name]=dict[name]:"data"===name?$.extend(this.data,dict.data):$.isFunction(dict[name])||NONE_NODE_DATA_MAP[name]||(this.data[name]=dict[name]);dict.children&&(this.removeChildren(),this.addChildren(dict.children)),this.renderTitle()},getChildren:function(){if(void 0!==this.hasChildren())return this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return $.inArray(this,this.parent.children)},getIndexHier:function(separator,digits){separator=separator||".";var s,res=[];return $.each(this.getParentList(!1,!0),(function(i,o){s=""+(o.getIndex()+1),digits&&(s=("0000000"+s).substr(-digits)),res.push(s)})),res.join(separator)},getKeyPath:function(excludeSelf){var path=[],sep=this.tree.options.keyPathSeparator;return this.visitParents((function(n){n.parent&&path.unshift(n.key)}),!excludeSelf),sep+path.join(sep)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){for(var level=0,dtn=this.parent;dtn;)level++,dtn=dtn.parent;return level},getNextSibling:function(){if(this.parent){var i,l,ac=this.parent.children;for(i=0,l=ac.length-1;i<l;i++)if(ac[i]===this)return ac[i+1]}return null},getParent:function(){return this.parent},getParentList:function(includeRoot,includeSelf){for(var l=[],dtn=includeSelf?this:this.parent;dtn;)(includeRoot||dtn.parent)&&l.unshift(dtn),dtn=dtn.parent;return l},getPrevSibling:function(){if(this.parent){var i,l,ac=this.parent.children;for(i=1,l=ac.length;i<l;i++)if(ac[i]===this)return ac[i-1]}return null},getSelectedNodes:function(stopOnParents){var nodeList=[];return this.visit((function(node){if(node.selected&&(nodeList.push(node),!0===stopOnParents))return"skip"})),nodeList},hasChildren:function(){if(this.lazy){if(null==this.children)return;if(0===this.children.length)return!1;if(1===this.children.length&&this.children[0].isStatusNode())return;return!0}return!(!this.children||!this.children.length)},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},info:function(msg){this.tree.options.debugLevel>=3&&(Array.prototype.unshift.call(arguments,this.toString()),consoleApply("info",arguments))},isActive:function(){return this.tree.activeNode===this},isBelowOf:function(otherNode){return this.getIndexHier(".",5)>otherNode.getIndexHier(".",5)},isChildOf:function(otherNode){return this.parent&&this.parent===otherNode},isDescendantOf:function(otherNode){if(!otherNode||otherNode.tree!==this.tree)return!1;for(var p=this.parent;p;){if(p===otherNode)return!0;p===p.parent&&$.error("Recursive parent link: "+p),p=p.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var p=this.parent;return!p||p.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var p=this.parent;return!p||p.children[p.children.length-1]===this},isLazy:function(){return!!this.lazy},isLoaded:function(){return!this.lazy||void 0!==this.hasChildren()},isLoading:function(){return!!this._isLoading},isRoot:function(){return this.isRootNode()},isPartsel:function(){return!this.selected&&!!this.partsel},isPartload:function(){return!!this.partload},isRootNode:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isStatusNode:function(){return!!this.statusNodeType},isPagingNode:function(){return"paging"===this.statusNodeType},isTopLevel:function(){return this.tree.rootNode===this.parent},isUndefined:function(){return void 0===this.hasChildren()},isVisible:function(){var i,l,parents=this.getParentList(!1,!1);for(i=0,l=parents.length;i<l;i++)if(!parents[i].expanded)return!1;return!0},lazyLoad:function(discard){return this.warn("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead."),this.load(discard)},load:function(forceReload){var res,source,that=this,wasExpanded=this.isExpanded();return _assert(this.isLazy(),"load() requires a lazy node"),forceReload||this.isUndefined()?(this.isLoaded()&&this.resetLazy(),!1===(source=this.tree._triggerNodeEvent("lazyLoad",this))?_getResolvedPromise(this):(_assert("boolean"!=typeof source,"lazyLoad event must return source in data.result"),res=this.tree._callHook("nodeLoadChildren",this,source),wasExpanded?(this.expanded=!0,res.always((function(){that.render()}))):res.always((function(){that.renderStatus()})),res)):_getResolvedPromise(this)},makeVisible:function(opts){var i,that=this,deferreds=[],dfd=new $.Deferred,parents=this.getParentList(!1,!1),len=parents.length,effects=!(opts&&!0===opts.noAnimation),scroll=!(opts&&!1===opts.scrollIntoView);for(i=len-1;i>=0;i--)deferreds.push(parents[i].setExpanded(!0,opts));return $.when.apply($,deferreds).done((function(){scroll?that.scrollIntoView(effects).done((function(){dfd.resolve()})):dfd.resolve()})),dfd.promise()},moveTo:function(targetNode,mode,map){void 0===mode||"over"===mode?mode="child":"firstChild"===mode&&(targetNode.children&&targetNode.children.length?(mode="before",targetNode=targetNode.children[0]):mode="child");var pos,prevParent=this.parent,targetParent="child"===mode?targetNode:targetNode.parent;if(this!==targetNode){if(this.parent?targetParent.isDescendantOf(this)&&$.error("Cannot move a node to its own descendant"):$.error("Cannot move system root"),targetParent!==prevParent&&prevParent.triggerModifyChild("remove",this),1===this.parent.children.length){if(this.parent===targetParent)return;this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1}else _assert((pos=$.inArray(this,this.parent.children))>=0,"invalid source parent"),this.parent.children.splice(pos,1);if(this.parent=targetParent,targetParent.hasChildren())switch(mode){case"child":targetParent.children.push(this);break;case"before":_assert((pos=$.inArray(targetNode,targetParent.children))>=0,"invalid target parent"),targetParent.children.splice(pos,0,this);break;case"after":_assert((pos=$.inArray(targetNode,targetParent.children))>=0,"invalid target parent"),targetParent.children.splice(pos+1,0,this);break;default:$.error("Invalid mode "+mode)}else targetParent.children=[this];map&&targetNode.visit(map,!0),targetParent===prevParent?targetParent.triggerModifyChild("move",this):targetParent.triggerModifyChild("add",this);var isCrossTree=!1;return this.tree!==targetNode.tree&&(this.warn("Cross-tree moveTo is experimantal!"),this.visit((function(n){n.tree=targetNode.tree}),!0),isCrossTree=!0),prevParent.isDescendantOf(targetParent)||prevParent.render(),targetParent.isDescendantOf(prevParent)||targetParent===prevParent||targetParent.render(),isCrossTree||void 0}},navigate:function(where,activate){var i,parents,res,KC=$.ui.keyCode,sib=null;function _goto(n){if(n){try{n.makeVisible({scrollIntoView:!1})}catch(e){}return $(n.span).is(":visible")?!1===activate?n.setFocus():n.setActive():(n.debug("Navigate: skipping hidden node"),void n.navigate(where,activate))}}switch(where){case KC.BACKSPACE:this.parent&&this.parent.parent&&(res=_goto(this.parent));break;case KC.HOME:this.tree.visit((function(n){if($(n.span).is(":visible"))return res=_goto(n),!1}));break;case KC.END:this.tree.visit((function(n){$(n.span).is(":visible")&&(res=n)})),res&&(res=_goto(res));break;case KC.LEFT:this.expanded?(this.setExpanded(!1),res=_goto(this)):this.parent&&this.parent.parent&&(res=_goto(this.parent));break;case KC.RIGHT:this.expanded||!this.children&&!this.lazy?this.children&&this.children.length&&(res=_goto(this.children[0])):(this.setExpanded(),res=_goto(this));break;case KC.UP:for(sib=this.getPrevSibling();sib&&!$(sib.span).is(":visible");)sib=sib.getPrevSibling();for(;sib&&sib.expanded&&sib.children&&sib.children.length;)sib=sib.children[sib.children.length-1];!sib&&this.parent&&this.parent.parent&&(sib=this.parent),res=_goto(sib);break;case KC.DOWN:if(this.expanded&&this.children&&this.children.length)sib=this.children[0];else for(i=(parents=this.getParentList(!1,!0)).length-1;i>=0;i--){for(sib=parents[i].getNextSibling();sib&&!$(sib.span).is(":visible");)sib=sib.getNextSibling();if(sib)break}res=_goto(sib);break;default:!1}return res||_getResolvedPromise()},remove:function(){return this.parent.removeChild(this)},removeChild:function(childNode){return this.tree._callHook("nodeRemoveChild",this,childNode)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},removeClass:function(className){return this.toggleClass(className,!1)},render:function(force,deep){return this.tree._callHook("nodeRender",this,force,deep)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},replaceWith:function(source){var res,parent=this.parent,pos=$.inArray(this,parent.children),that=this;return _assert(this.isPagingNode(),"replaceWith() currently requires a paging status node"),(res=this.tree._callHook("nodeLoadChildren",this,source)).done((function(data){var children=that.children;for(i=0;i<children.length;i++)children[i].parent=parent;parent.children.splice.apply(parent.children,[pos+1,0].concat(children)),that.children=null,that.remove(),parent.render()})).fail((function(){that.setExpanded()})),res},resetLazy:function(){this.removeChildren(),this.expanded=!1,this.lazy=!0,this.children=void 0,this.renderStatus()},scheduleAction:function(mode,ms){this.tree.timer&&clearTimeout(this.tree.timer),this.tree.timer=null;var self=this;switch(mode){case"cancel":break;case"expand":this.tree.timer=setTimeout((function(){self.tree.debug("setTimeout: trigger expand"),self.setExpanded(!0)}),ms);break;case"activate":this.tree.timer=setTimeout((function(){self.tree.debug("setTimeout: trigger activate"),self.setActive(!0)}),ms);break;default:$.error("Invalid mode "+mode)}},scrollIntoView:function(effects,options){var x;void 0!==options&&((x=options).tree&&void 0!==x.statusNodeType)&&(this.warn("scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead."),options={topNode:options});var topNodeY,nodeY,containerOffsetTop,opts=$.extend({effects:!0===effects?{duration:200,queue:!1}:effects,scrollOfs:this.tree.options.scrollOfs,scrollParent:this.tree.options.scrollParent||this.tree.$container,topNode:null},options),dfd=new $.Deferred,that=this,nodeHeight=$(this.span).height(),$container=$(opts.scrollParent),topOfs=opts.scrollOfs.top||0,bottomOfs=opts.scrollOfs.bottom||0,containerHeight=$container.height(),scrollTop=$container.scrollTop(),$animateTarget=$container,isParentWindow=$container[0]===window,topNode=opts.topNode||null,newScrollTop=null;return $(this.span).is(":visible")?(isParentWindow?(nodeY=$(this.span).offset().top,topNodeY=topNode&&topNode.span?$(topNode.span).offset().top:0,$animateTarget=$("html,body")):(_assert($container[0]!==document&&$container[0]!==document.body,"scrollParent should be a simple element or `window`, not document or body."),containerOffsetTop=$container.offset().top,nodeY=$(this.span).offset().top-containerOffsetTop+scrollTop,topNodeY=topNode?$(topNode.span).offset().top-containerOffsetTop+scrollTop:0,containerHeight-=Math.max(0,$container.innerHeight()-$container[0].clientHeight)),nodeY<scrollTop+topOfs?newScrollTop=nodeY-topOfs:nodeY+nodeHeight>scrollTop+containerHeight-bottomOfs&&(newScrollTop=nodeY+nodeHeight-containerHeight+bottomOfs,topNode&&(_assert(topNode.isRootNode()||$(topNode.span).is(":visible"),"topNode must be visible"),topNodeY<newScrollTop&&(newScrollTop=topNodeY-topOfs))),null!==newScrollTop?opts.effects?(opts.effects.complete=function(){dfd.resolveWith(that)},$animateTarget.stop(!0).animate({scrollTop:newScrollTop},opts.effects)):($animateTarget[0].scrollTop=newScrollTop,dfd.resolveWith(this)):dfd.resolveWith(this),dfd.promise()):(this.warn("scrollIntoView(): node is invisible."),_getResolvedPromise())},setActive:function(flag,opts){return this.tree._callHook("nodeSetActive",this,flag,opts)},setExpanded:function(flag,opts){return this.tree._callHook("nodeSetExpanded",this,flag,opts)},setFocus:function(flag){return this.tree._callHook("nodeSetFocus",this,flag)},setSelected:function(flag,opts){return this.tree._callHook("nodeSetSelected",this,flag,opts)},setStatus:function(status,message,details){return this.tree._callHook("nodeSetStatus",this,status,message,details)},setTitle:function(title){this.title=title,this.renderTitle(),this.triggerModify("rename")},sortChildren:function(cmp,deep){var i,l,cl=this.children;if(cl){if(cmp=cmp||function(a,b){var x=a.title.toLowerCase(),y=b.title.toLowerCase();return x===y?0:x>y?1:-1},cl.sort(cmp),deep)for(i=0,l=cl.length;i<l;i++)cl[i].children&&cl[i].sortChildren(cmp,"$norender$");"$norender$"!==deep&&this.render(),this.triggerModifyChild("sort")}},toDict:function(recursive,callback){var i,l,node,dict={},self=this;if($.each(NODE_ATTRS,(function(i,a){(self[a]||!1===self[a])&&(dict[a]=self[a])})),$.isEmptyObject(this.data)||(dict.data=$.extend({},this.data),$.isEmptyObject(dict.data)&&delete dict.data),callback&&callback(dict,self),recursive&&this.hasChildren())for(dict.children=[],i=0,l=this.children.length;i<l;i++)(node=this.children[i]).isStatusNode()||dict.children.push(node.toDict(!0,callback));return dict},toggleClass:function(value,flag){var className,hasClass,classNames=value.match(/\S+/g)||[],i=0,wasAdded=!1,statusElem=this[this.tree.statusClassPropName],curClasses=" "+(this.extraClasses||"")+" ";for(statusElem&&$(statusElem).toggleClass(value,flag);className=classNames[i++];)if(hasClass=curClasses.indexOf(" "+className+" ")>=0,flag=void 0===flag?!hasClass:!!flag)hasClass||(curClasses+=className+" ",wasAdded=!0);else for(;curClasses.indexOf(" "+className+" ")>-1;)curClasses=curClasses.replace(" "+className+" "," ");return this.extraClasses=$.trim(curClasses),wasAdded},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"FancytreeNode@"+this.key+"[title='"+this.title+"']"},triggerModifyChild:function(operation,childNode,extra){var data,modifyChild=this.tree.options.modifyChild;modifyChild&&(childNode&&childNode.parent!==this&&$.error("childNode "+childNode+" is not a child of "+this),data={node:this,tree:this.tree,operation:operation,childNode:childNode||null},extra&&$.extend(data,extra),modifyChild({type:"modifyChild"},data))},triggerModify:function(operation,extra){this.parent.triggerModifyChild(operation,this,extra)},visit:function(fn,includeSelf){var i,l,res=!0,children=this.children;if(!0===includeSelf&&(!1===(res=fn(this))||"skip"===res))return res;if(children)for(i=0,l=children.length;i<l&&!1!==(res=children[i].visit(fn,!0));i++);return res},visitAndLoad:function(fn,includeSelf,_recursion){var dfd,res,loaders,node=this;return!fn||!0!==includeSelf||!1!==(res=fn(node))&&"skip"!==res?node.children||node.lazy?(dfd=new $.Deferred,loaders=[],node.load().done((function(){for(var i=0,l=node.children.length;i<l;i++){if(!1===(res=node.children[i].visitAndLoad(fn,!0,!0))){dfd.reject();break}"skip"!==res&&loaders.push(res)}$.when.apply(this,loaders).then((function(){dfd.resolve()}))})),dfd.promise()):_getResolvedPromise():_recursion?res:_getResolvedPromise()},visitParents:function(fn,includeSelf){if(includeSelf&&!1===fn(this))return!1;for(var p=this.parent;p;){if(!1===fn(p))return!1;p=p.parent}return!0},visitSiblings:function(fn,includeSelf){var i,l,n,ac=this.parent.children;for(i=0,l=ac.length;i<l;i++)if(n=ac[i],(includeSelf||n!==this)&&!1===fn(n))return!1;return!0},warn:function(msg){this.tree.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),consoleApply("warn",arguments))}},Fancytree.prototype={_makeHookContext:function(obj,originalEvent,extra){var ctx,tree;return void 0!==obj.node?(originalEvent&&obj.originalEvent!==originalEvent&&$.error("invalid args"),ctx=obj):obj.tree?ctx={node:obj,tree:tree=obj.tree,widget:tree.widget,options:tree.widget.options,originalEvent:originalEvent,typeInfo:tree.types[obj.type]||{}}:obj.widget?ctx={node:null,tree:obj,widget:obj.widget,options:obj.widget.options,originalEvent:originalEvent}:$.error("invalid args"),extra&&$.extend(ctx,extra),ctx},_callHook:function(funcName,contextObject,_extraArgs){var ctx=this._makeHookContext(contextObject),fn=this[funcName],args=Array.prototype.slice.call(arguments,2);return $.isFunction(fn)||$.error("_callHook('"+funcName+"') is not a function"),args.unshift(ctx),fn.apply(this,args)},_setExpiringValue:function(key,value,ms){this._tempCache[key]={value:value,expire:Date.now()+(+ms||50)}},_getExpiringValue:function(key){var entry=this._tempCache[key];return entry&&entry.expire>Date.now()?entry.value:(delete this._tempCache[key],null)},_requireExtension:function(name,required,before,message){before=!!before;var thisName=this._local.name,extList=this.options.extensions,isBefore=$.inArray(name,extList)<$.inArray(thisName,extList),isMissing=required&&null==this.ext[name],badOrder=!isMissing&&null!=before&&before!==isBefore;return _assert(thisName&&thisName!==name,"invalid or same name"),!isMissing&&!badOrder||(message||(isMissing||required?(message="'"+thisName+"' extension requires '"+name+"'",badOrder&&(message+=" to be registered "+(before?"before":"after")+" itself")):message="If used together, `"+name+"` must be registered "+(before?"before":"after")+" `"+thisName+"`"),$.error(message),!1)},activateKey:function(key){var node=this.getNodeByKey(key);return node?node.setActive():this.activeNode&&this.activeNode.setActive(!1),node},addPagingNode:function(node,mode){return this.rootNode.addPagingNode(node,mode)},applyPatch:function(patchList){var dfd,i,p2,key,patch,node,patchCount=patchList.length,deferredList=[];for(i=0;i<patchCount;i++)_assert(2===(p2=patchList[i]).length,"patchList must be an array of length-2-arrays"),key=p2[0],patch=p2[1],(node=null===key?this.rootNode:this.getNodeByKey(key))?(dfd=new $.Deferred,deferredList.push(dfd),node.applyPatch(patch).always(_makeResolveFunc(dfd,node))):this.warn("could not find node with key '"+key+"'");return $.when.apply($,deferredList).promise()},clear:function(source){this._callHook("treeClear",this)},count:function(){return this.rootNode.countChildren()},debug:function(msg){this.options.debugLevel>=4&&(Array.prototype.unshift.call(arguments,this.toString()),consoleApply("log",arguments))},enableUpdate:function(flag){return flag=!1!==flag,!!this._enableUpdate==!!flag?flag:(this._enableUpdate=flag,flag?(this.debug("enableUpdate(true): redraw "),this.render()):this.debug("enableUpdate(false)..."),!flag)},findAll:function(match){return this.rootNode.findAll(match)},findFirst:function(match){return this.rootNode.findFirst(match)},findNextNode:function(match,startNode,visibleOnly){var reMatch;match="string"==typeof match?(reMatch=new RegExp("^"+match,"i"),function(node){return reMatch.test(node.title)}):match,startNode=startNode||this.getFirstChild();var stopNode=null,parentChildren=startNode.parent.children,matchingNode=null,walkVisible=function(parent,idx,fn){var i,grandParent,parentChildren=parent.children,siblingCount=parentChildren.length,node=parentChildren[idx];if(node&&!1===fn(node))return!1;if(node&&node.children&&node.expanded&&!1===walkVisible(node,0,fn))return!1;for(i=idx+1;i<siblingCount;i++)if(!1===walkVisible(parent,i,fn))return!1;return(grandParent=parent.parent)?walkVisible(grandParent,grandParent.children.indexOf(parent)+1,fn):walkVisible(parent,0,fn)};return walkVisible(startNode.parent,parentChildren.indexOf(startNode),(function(node){return node!==stopNode&&(stopNode=stopNode||node,$(node.span).is(":visible")?(!match(node)||(matchingNode=node)===startNode)&&void 0:void node.debug("quicksearch: skipping hidden node"))})),matchingNode},generateFormElements:function(selected,active,opts){opts=opts||{};var nodeList,selectedName="string"==typeof selected?selected:"ft_"+this._id+"[]",activeName="string"==typeof active?active:"ft_"+this._id+"_active",id="fancytree_result_"+this._id,$result=$("#"+id),stopOnParents=3===this.options.selectMode&&!1!==opts.stopOnParents;function _appender(node){$result.append($("<input>",{type:"checkbox",name:selectedName,value:node.key,checked:!0}))}$result.length?$result.empty():$result=$("<div>",{id:id}).hide().insertAfter(this.$container),!1!==active&&this.activeNode&&$result.append($("<input>",{type:"radio",name:activeName,value:this.activeNode.key,checked:!0})),opts.filter?this.visit((function(node){var res=opts.filter(node);if("skip"===res)return res;!1!==res&&_appender(node)})):!1!==selected&&(nodeList=this.getSelectedNodes(stopOnParents),$.each(nodeList,(function(idx,node){_appender(node)})))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(){return this.focusNode},getNodeByKey:function(key,searchRoot){var el,match;return!searchRoot&&(el=document.getElementById(this.options.idPrefix+key))?el.ftnode?el.ftnode:null:(searchRoot=searchRoot||this.rootNode,match=null,searchRoot.visit((function(node){if(node.key===key)return match=node,!1}),!0),match)},getRootNode:function(){return this.rootNode},getSelectedNodes:function(stopOnParents){return this.rootNode.getSelectedNodes(stopOnParents)},hasFocus:function(){return!!this._hasFocus},info:function(msg){this.options.debugLevel>=3&&(Array.prototype.unshift.call(arguments,this.toString()),consoleApply("info",arguments))},loadKeyPath:function(keyPathList,optsOrCallback){var callback,i,path,self=this,dfd=new $.Deferred,parent=this.getRootNode(),sep=this.options.keyPathSeparator,pathSegList=[],opts=$.extend({},optsOrCallback);for("function"==typeof optsOrCallback?callback=optsOrCallback:optsOrCallback&&optsOrCallback.callback&&(callback=optsOrCallback.callback),opts.callback=function(ctx,node,status){callback&&callback.call(ctx,node,status),dfd.notifyWith(ctx,[{node:node,status:status}])},null==opts.matchKey&&(opts.matchKey=function(node,key){return node.key===key}),$.isArray(keyPathList)||(keyPathList=[keyPathList]),i=0;i<keyPathList.length;i++)(path=keyPathList[i]).charAt(0)===sep&&(path=path.substr(1)),pathSegList.push(path.split(sep));return setTimeout((function(){self._loadKeyPathImpl(dfd,opts,parent,pathSegList).done((function(){dfd.resolve()}))}),0),dfd.promise()},_loadKeyPathImpl:function(dfd,opts,parent,pathSegList){var deferredList,i,key,node,remainMap,tmpParent,segList,subDfd,self=this;function __findChild(parent,key){var i,l,cl=parent.children;if(cl)for(i=0,l=cl.length;i<l;i++)if(opts.matchKey(cl[i],key))return cl[i];return null}for(remainMap={},i=0;i<pathSegList.length;i++)for(segList=pathSegList[i],tmpParent=parent;segList.length;){if(key=segList.shift(),!(node=__findChild(tmpParent,key))){this.warn("loadKeyPath: key not found: "+key+" (parent: "+tmpParent+")"),opts.callback(this,key,"error");break}if(0===segList.length){opts.callback(this,node,"ok");break}if(node.lazy&&void 0===node.hasChildren()){opts.callback(this,node,"loaded"),remainMap[key=node.key]?remainMap[key].pathSegList.push(segList):remainMap[key]={parent:node,pathSegList:[segList]};break}opts.callback(this,node,"loaded"),tmpParent=node}function __lazyload(dfd,parent,pathSegList){opts.callback(self,parent,"loading"),parent.load().done((function(){self._loadKeyPathImpl.call(self,dfd,opts,parent,pathSegList).always(_makeResolveFunc(dfd,self))})).fail((function(errMsg){self.warn("loadKeyPath: error loading lazy "+parent),opts.callback(self,node,"error"),dfd.rejectWith(self)}))}for(var nodeKey in deferredList=[],remainMap){var remain=remainMap[nodeKey];subDfd=new $.Deferred,deferredList.push(subDfd),__lazyload(subDfd,remain.parent,remain.pathSegList)}return $.when.apply($,deferredList).promise()},reactivate:function(setFocus){var res,node=this.activeNode;return node?(this.activeNode=null,res=node.setActive(!0,{noFocus:!0}),setFocus&&node.setFocus(),res):_getResolvedPromise()},reload:function(source){return this._callHook("treeClear",this),this._callHook("treeLoad",this,source)},render:function(force,deep){return this.rootNode.render(force,deep)},selectAll:function(flag){this.visit((function(node){node.setSelected(flag)}))},setFocus:function(flag){return this._callHook("treeSetFocus",this,flag)},toDict:function(includeRoot,callback){var res=this.rootNode.toDict(!0,callback);return includeRoot?res:res.children},toString:function(){return"Fancytree@"+this._id},_triggerNodeEvent:function(type,node,originalEvent,extra){var ctx=this._makeHookContext(node,originalEvent,extra),res=this.widget._trigger(type,originalEvent,ctx);return!1!==res&&void 0!==ctx.result?ctx.result:res},_triggerTreeEvent:function(type,originalEvent,extra){var ctx=this._makeHookContext(this,originalEvent,extra),res=this.widget._trigger(type,originalEvent,ctx);return!1!==res&&void 0!==ctx.result?ctx.result:res},visit:function(fn){return this.rootNode.visit(fn,!1)},visitRows:function(fn,opts){if(opts&&opts.reverse)return delete opts.reverse,this._visitRowsUp(fn,opts);var i,parent,siblings,siblingOfs=0,skipFirstNode=!1===opts.includeSelf,includeHidden=!!opts.includeHidden,node=opts.start||this.rootNode.children[0];for(parent=node.parent;parent;){for(i=(siblings=parent.children).indexOf(node)+siblingOfs;i<siblings.length;i++){if(node=siblings[i],!skipFirstNode&&!1===fn(node))return!1;if(skipFirstNode=!1,node.children&&node.children.length&&(includeHidden||node.expanded)&&!1===node.visit((function(n){return!1!==fn(n)&&(includeHidden||!n.children||n.expanded?void 0:"skip")}),!1))return!1}node=parent,parent=parent.parent,siblingOfs=1}return!0},_visitRowsUp:function(fn,opts){for(var children,idx,parent,includeHidden=!!opts.includeHidden,node=opts.start||this.rootNode.children[0];;){if((children=(parent=node.parent).children)[0]===node)node=parent,children=parent.children;else for(idx=children.indexOf(node),node=children[idx-1];(includeHidden||node.expanded)&&node.children&&node.children.length;)parent=node,node=(children=node.children)[children.length-1];if((includeHidden||$(node.span).is(":visible"))&&!1===fn(node))return!1}},warn:function(msg){this.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),consoleApply("warn",arguments))}},$.extend(Fancytree.prototype,{nodeClick:function(ctx){var activate,expand,targetType=ctx.targetType,node=ctx.node;if("expander"===targetType){if(node.isLoading())return void node.debug("Got 2nd click while loading: ignored");this._callHook("nodeToggleExpanded",ctx)}else if("checkbox"===targetType)this._callHook("nodeToggleSelected",ctx),ctx.options.focusOnSelect&&this._callHook("nodeSetFocus",ctx,!0);else{if(expand=!1,activate=!0,node.folder)switch(ctx.options.clickFolderMode){case 2:expand=!0,activate=!1;break;case 3:activate=!0,expand=!0}activate&&(this.nodeSetFocus(ctx),this._callHook("nodeSetActive",ctx,!0)),expand&&this._callHook("nodeToggleExpanded",ctx)}},nodeCollapseSiblings:function(ctx,callOpts){var ac,i,l,node=ctx.node;if(node.parent)for(i=0,l=(ac=node.parent.children).length;i<l;i++)ac[i]!==node&&ac[i].expanded&&this._callHook("nodeSetExpanded",ac[i],!1,callOpts)},nodeDblclick:function(ctx){"title"===ctx.targetType&&4===ctx.options.clickFolderMode&&this._callHook("nodeToggleExpanded",ctx),"title"===ctx.targetType&&ctx.originalEvent.preventDefault()},nodeKeydown:function(ctx){var matchNode,stamp,focusNode,event=ctx.originalEvent,node=ctx.node,tree=ctx.tree,opts=ctx.options,which=event.which,whichChar=String.fromCharCode(which),clean=!(event.altKey||event.ctrlKey||event.metaKey||event.shiftKey),$target=$(event.target),handled=!0,activate=!(event.ctrlKey||!opts.autoActivate);if(node||(focusNode=this.getActiveNode()||this.getFirstChild())&&(focusNode.setFocus(),(node=ctx.node=this.focusNode).debug("Keydown force focus on active node")),opts.quicksearch&&clean&&/\w/.test(whichChar)&&!SPECIAL_KEYCODES[which]&&!$target.is(":input:enabled"))return(stamp=Date.now())-tree.lastQuicksearchTime>500&&(tree.lastQuicksearchTerm=""),tree.lastQuicksearchTime=stamp,tree.lastQuicksearchTerm+=whichChar,(matchNode=tree.findNextNode(tree.lastQuicksearchTerm,tree.getActiveNode()))&&matchNode.setActive(),void event.preventDefault();switch(FT.eventToString(event)){case"+":case"=":tree.nodeSetExpanded(ctx,!0);break;case"-":tree.nodeSetExpanded(ctx,!1);break;case"space":node.isPagingNode()?tree._triggerNodeEvent("clickPaging",ctx,event):FT.evalOption("checkbox",node,node,opts,!1)?tree.nodeToggleSelected(ctx):tree.nodeSetActive(ctx,!0);break;case"return":tree.nodeSetActive(ctx,!0);break;case"home":case"end":case"backspace":case"left":case"right":case"up":case"down":node.navigate(event.which,activate);break;default:handled=!1}handled&&event.preventDefault()},nodeLoadChildren:function(ctx,source){var ajax,delay,dfd,tree=ctx.tree,node=ctx.node,requestId=Date.now();if($.isFunction(source)&&(source=source.call(tree,{type:"source"},ctx),_assert(!$.isFunction(source),"source callback must not return another function")),source.url&&(node._requestId&&node.warn("Recursive load request #"+requestId+" while #"+node._requestId+" is pending."),ajax=$.extend({},ctx.options.ajax,source),node._requestId=requestId,ajax.debugDelay?(delay=ajax.debugDelay,$.isArray(delay)&&(delay=delay[0]+Math.random()*(delay[1]-delay[0])),node.warn("nodeLoadChildren waiting debugDelay "+Math.round(delay)+" ms ..."),ajax.debugDelay=!1,dfd=$.Deferred((function(dfd){setTimeout((function(){$.ajax(ajax).done((function(){dfd.resolveWith(this,arguments)})).fail((function(){dfd.rejectWith(this,arguments)}))}),delay)}))):dfd=$.ajax(ajax),source=new $.Deferred,dfd.done((function(data,textStatus,jqXHR){var errorObj,res;if("json"!==this.dataType&&"jsonp"!==this.dataType||"string"!=typeof data||$.error("Ajax request returned a string (did you get the JSON dataType wrong?)."),node._requestId&&node._requestId>requestId)source.rejectWith(this,["$recursive_request"]);else{if(ctx.options.postProcess){try{res=tree._triggerNodeEvent("postProcess",ctx,ctx.originalEvent,{response:data,error:null,dataType:this.dataType})}catch(e){res={error:e,message:""+e,details:"postProcess failed"}}if(res.error)return errorObj=$.isPlainObject(res.error)?res.error:{message:res.error},errorObj=tree._makeHookContext(node,null,errorObj),void source.rejectWith(this,[errorObj]);data=$.isArray(res)?res:data}else data&&data.hasOwnProperty("d")&&ctx.options.enableAspx&&(data="string"==typeof data.d?$.parseJSON(data.d):data.d);source.resolveWith(this,[data])}})).fail((function(jqXHR,textStatus,errorThrown){var errorObj=tree._makeHookContext(node,null,{error:jqXHR,args:Array.prototype.slice.call(arguments),message:errorThrown,details:jqXHR.status+": "+errorThrown});source.rejectWith(this,[errorObj])}))),$.isFunction(source.then)&&$.isFunction(source.catch)&&(dfd=source,source=new $.Deferred,dfd.then((function(value){source.resolve(value)}),(function(reason){source.reject(reason)}))),$.isFunction(source.promise))tree.nodeSetStatus(ctx,"loading"),source.done((function(children){tree.nodeSetStatus(ctx,"ok"),node._requestId=null})).fail((function(error){var ctxErr;"$recursive_request"!==error?(error.node&&error.error&&error.message?ctxErr=error:"[object Object]"===(ctxErr=tree._makeHookContext(node,null,{error:error,args:Array.prototype.slice.call(arguments),message:error?error.message||error.toString():""})).message&&(ctxErr.message=""),node.warn("Load children failed ("+ctxErr.message+")",ctxErr),!1!==tree._triggerNodeEvent("loadError",ctxErr,null)&&tree.nodeSetStatus(ctx,"error",ctxErr.message,ctxErr.details)):node.warn("Ignored response for obsolete load request #"+requestId+" (expected #"+node._requestId+")")}));else if(ctx.options.postProcess){var res=tree._triggerNodeEvent("postProcess",ctx,ctx.originalEvent,{response:source,error:null,dataType:typeof source});source=$.isArray(res)?res:source}return $.when(source).done((function(children){var metaData;$.isPlainObject(children)&&(_assert(node.isRootNode(),"source may only be an object for root nodes (expecting an array of child objects otherwise)"),_assert($.isArray(children.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),metaData=children,children=children.children,delete metaData.children,$.each(TREE_ATTRS,(function(i,attr){void 0!==metaData[attr]&&(tree[attr]=metaData[attr],delete metaData[attr])})),$.extend(tree.data,metaData)),_assert($.isArray(children),"expected array of children"),node._setChildren(children),tree._triggerNodeEvent("loadChildren",node)}))},nodeLoadKeyPath:function(ctx,keyPathList){},nodeRemoveChild:function(ctx,childNode){var idx,node=ctx.node,subCtx=$.extend({},ctx,{node:childNode}),children=node.children;if(1===children.length)return _assert(childNode===children[0],"invalid single child"),this.nodeRemoveChildren(ctx);this.activeNode&&(childNode===this.activeNode||this.activeNode.isDescendantOf(childNode))&&this.activeNode.setActive(!1),this.focusNode&&(childNode===this.focusNode||this.focusNode.isDescendantOf(childNode))&&(this.focusNode=null),this.nodeRemoveMarkup(subCtx),this.nodeRemoveChildren(subCtx),_assert((idx=$.inArray(childNode,children))>=0,"invalid child"),node.triggerModifyChild("remove",childNode),childNode.visit((function(n){n.parent=null}),!0),this._callHook("treeRegisterNode",this,!1,childNode),children.splice(idx,1)},nodeRemoveChildMarkup:function(ctx){var node=ctx.node;node.ul&&(node.isRootNode()?$(node.ul).empty():($(node.ul).remove(),node.ul=null),node.visit((function(n){n.li=n.ul=null})))},nodeRemoveChildren:function(ctx){var tree=ctx.tree,node=ctx.node;node.children&&(this.activeNode&&this.activeNode.isDescendantOf(node)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(node)&&(this.focusNode=null),this.nodeRemoveChildMarkup(ctx),$.extend({},ctx),node.triggerModifyChild("remove",null),node.visit((function(n){n.parent=null,tree._callHook("treeRegisterNode",tree,!1,n)})),node.lazy?node.children=[]:node.children=null,node.isRootNode()||(node.expanded=!1),this.nodeRenderStatus(ctx))},nodeRemoveMarkup:function(ctx){var node=ctx.node;node.li&&($(node.li).remove(),node.li=null),this.nodeRemoveChildMarkup(ctx)},nodeRender:function(ctx,force,deep,collapsed,_recursive){var childLI,childNode1,childNode2,i,l,next,subCtx,node=ctx.node,tree=ctx.tree,opts=ctx.options,aria=opts.aria,firstTime=!1,parent=node.parent,isRootNode=!parent,children=node.children,successorLi=null;if(!1!==tree._enableUpdate&&(isRootNode||parent.ul)){if(_assert(isRootNode||parent.ul,"parent UL must exist"),isRootNode||(node.li&&(force||node.li.parentNode!==node.parent.ul)&&(node.li.parentNode===node.parent.ul?successorLi=node.li.nextSibling:this.debug("Unlinking "+node+" (must be child of "+node.parent+")"),this.nodeRemoveMarkup(ctx)),node.li?this.nodeRenderStatus(ctx):(firstTime=!0,node.li=document.createElement("li"),node.li.ftnode=node,node.key&&opts.generateIds&&(node.li.id=opts.idPrefix+node.key),node.span=document.createElement("span"),node.span.className="fancytree-node",aria&&!node.tr&&$(node.li).attr("role","treeitem"),node.li.appendChild(node.span),this.nodeRenderTitle(ctx),opts.createNode&&opts.createNode.call(tree,{type:"createNode"},ctx)),opts.renderNode&&opts.renderNode.call(tree,{type:"renderNode"},ctx)),children){if(isRootNode||node.expanded||!0===deep){for(node.ul||(node.ul=document.createElement("ul"),(!0!==collapsed||_recursive)&&node.expanded||(node.ul.style.display="none"),aria&&$(node.ul).attr("role","group"),node.li?node.li.appendChild(node.ul):node.tree.$div.append(node.ul)),i=0,l=children.length;i<l;i++)subCtx=$.extend({},ctx,{node:children[i]}),this.nodeRender(subCtx,force,deep,!1,!0);for(childLI=node.ul.firstChild;childLI;)(childNode2=childLI.ftnode)&&childNode2.parent!==node?(node.debug("_fixParent: remove missing "+childNode2,childLI),next=childLI.nextSibling,childLI.parentNode.removeChild(childLI),childLI=next):childLI=childLI.nextSibling;for(childLI=node.ul.firstChild,i=0,l=children.length-1;i<l;i++)(childNode1=children[i])!==(childNode2=childLI.ftnode)?node.ul.insertBefore(childNode1.li,childNode2.li):childLI=childLI.nextSibling}}else node.ul&&(this.warn("remove child markup for "+node),this.nodeRemoveChildMarkup(ctx));isRootNode||firstTime&&parent.ul.insertBefore(node.li,successorLi)}},nodeRenderTitle:function(ctx,title){var checkbox,className,icon,nodeTitle,role,tooltip,iconTooltip,node=ctx.node,tree=ctx.tree,opts=ctx.options,aria=opts.aria,level=node.getLevel(),ares=[];if(void 0!==title&&(node.title=title),node.span&&!1!==tree._enableUpdate){var arrow;if(role=aria&&!1!==node.hasChildren()?" role='button'":"",node.hasChildren())for(var i=0;i<node.children.length;i++){if(1==node.children[i].folder){arrow="";break}arrow="style='background-image:none'"}level<opts.minExpandLevel?(node.lazy||(node.expanded=!0),level>1&&ares.push("<span "+role+" class='fancytree-expander fancytree-expander-fixed'></span>")):ares.push("<span "+role+arrow+" class='fancytree-expander'></span>"),(checkbox=FT.evalOption("checkbox",node,node,opts,!1))&&!node.isStatusNode()&&(role=aria?" role='checkbox'":"",className="fancytree-checkbox",("radio"===checkbox||node.parent&&node.parent.radiogroup)&&(className+=" fancytree-radio"),ares.push("<span "+role+" class='"+className+"'></span>")),void 0!==node.data.iconClass&&(node.icon?$.error("'iconClass' node option is deprecated since v2.14.0: use 'icon' only instead"):(node.warn("'iconClass' node option is deprecated since v2.14.0: use 'icon' instead"),node.icon=node.data.iconClass)),!1!==(icon=FT.evalOption("icon",node,node,opts,!0))&&(role=aria?" role='presentation'":"",iconTooltip=(iconTooltip=FT.evalOption("iconTooltip",node,node,opts,null))?" title='"+_escapeTooltip(iconTooltip)+"'":"","string"==typeof icon?TEST_IMG.test(icon)?(icon="/"===icon.charAt(0)?icon:(opts.imagePath||"")+icon,ares.push("<img src='"+icon+"' class='fancytree-icon'"+iconTooltip+" alt='' />")):ares.push("<span "+role+" class='fancytree-custom-icon "+icon+"'"+iconTooltip+"></span>"):icon.text?ares.push("<span "+role+" class='fancytree-custom-icon "+(icon.addClass||"")+"'"+iconTooltip+">"+FT.escapeHtml(icon.text)+"</span>"):icon.html?ares.push("<span "+role+" class='fancytree-custom-icon "+(icon.addClass||"")+"'"+iconTooltip+">"+icon.html+"</span>"):ares.push("<span "+role+" class='fancytree-icon'"+iconTooltip+"></span>")),nodeTitle="",opts.renderTitle&&(nodeTitle=opts.renderTitle.call(tree,{type:"renderTitle"},ctx)||""),nodeTitle||(!0===(tooltip=FT.evalOption("tooltip",node,node,opts,null))&&(tooltip=node.title),nodeTitle="<span class='fancytree-title'"+(tooltip=tooltip?" title='"+_escapeTooltip(tooltip)+"'":"")+(opts.titlesTabbable?" tabindex='0'":"")+">"+(opts.escapeTitles?FT.escapeHtml(node.title):node.title)+"</span>"),ares.push(nodeTitle),ares.push("<img src='/assets/img/ic_more.png' class='fancytree-more-option' >"),node.span.innerHTML=ares.join(""),this.nodeRenderStatus(ctx),opts.enhanceTitle&&(ctx.$title=$(">span.fancytree-title",node.span),nodeTitle=opts.enhanceTitle.call(tree,{type:"enhanceTitle"},ctx)||"")}},nodeRenderStatus:function(ctx){var $ariaElem,node=ctx.node,tree=ctx.tree,opts=ctx.options,hasChildren=node.hasChildren(),isLastSib=node.isLastSibling(),aria=opts.aria,cn=opts._classNames,cnList=[],statusElem=node[tree.statusClassPropName];statusElem&&!1!==tree._enableUpdate&&(aria&&($ariaElem=$(node.tr||node.li)),cnList.push(cn.node),tree.activeNode===node&&cnList.push(cn.active),tree.focusNode===node&&cnList.push(cn.focused),node.expanded&&cnList.push(cn.expanded),aria&&(!1!==hasChildren?$ariaElem.attr("aria-expanded",Boolean(node.expanded)):$ariaElem.removeAttr("aria-expanded")),node.folder&&cnList.push(cn.folder),!1!==hasChildren&&cnList.push(cn.hasChildren),isLastSib&&cnList.push(cn.lastsib),node.lazy&&null==node.children&&cnList.push(cn.lazy),node.partload&&cnList.push(cn.partload),node.partsel&&cnList.push(cn.partsel),FT.evalOption("unselectable",node,node,opts,!1)&&cnList.push(cn.unselectable),node._isLoading&&cnList.push(cn.loading),node._error&&cnList.push(cn.error),node.statusNodeType&&cnList.push(cn.statusNodePrefix+node.statusNodeType),node.selected?(cnList.push(cn.selected),aria&&$ariaElem.attr("aria-selected",!0)):aria&&$ariaElem.attr("aria-selected",!1),node.extraClasses&&cnList.push(node.extraClasses),!1===hasChildren?cnList.push(cn.combinedExpanderPrefix+"n"+(isLastSib?"l":"")):cnList.push(cn.combinedExpanderPrefix+(node.expanded?"e":"c")+(node.lazy&&null==node.children?"d":"")+(isLastSib?"l":"")),cnList.push(cn.combinedIconPrefix+(node.expanded?"e":"c")+(node.folder?"f":"")),statusElem.className=cnList.join(" "),node.li&&$(node.li).toggleClass(cn.lastsib,isLastSib))},nodeSetActive:function(ctx,flag,callOpts){callOpts=callOpts||{};var subCtx,node=ctx.node,tree=ctx.tree,opts=ctx.options,noEvents=!0===callOpts.noEvents,noFocus=!0===callOpts.noFocus;return node===tree.activeNode===(flag=!1!==flag)?_getResolvedPromise(node):flag&&!noEvents&&!1===this._triggerNodeEvent("beforeActivate",node,ctx.originalEvent)?_getRejectedPromise(node,["rejected"]):(flag?(tree.activeNode&&(_assert(tree.activeNode!==node,"node was active (inconsistency)"),subCtx=$.extend({},ctx,{node:tree.activeNode}),tree.nodeSetActive(subCtx,!1),_assert(null===tree.activeNode,"deactivate was out of sync?")),opts.activeVisible&&node.makeVisible({scrollIntoView:noFocus&&null==tree.focusNode}),tree.activeNode=node,tree.nodeRenderStatus(ctx),noFocus||tree.nodeSetFocus(ctx),noEvents||tree._triggerNodeEvent("activate",node,ctx.originalEvent)):(_assert(tree.activeNode===node,"node was not active (inconsistency)"),tree.activeNode=null,this.nodeRenderStatus(ctx),noEvents||ctx.tree._triggerNodeEvent("deactivate",node,ctx.originalEvent)),_getResolvedPromise(node))},nodeSetExpanded:function(ctx,flag,callOpts){callOpts=callOpts||{};var _afterLoad,dfd,i,l,parents,prevAC,node=ctx.node,tree=ctx.tree,opts=ctx.options,noAnimation=!0===callOpts.noAnimation,noEvents=!0===callOpts.noEvents;if(flag=!1!==flag,node.expanded&&flag||!node.expanded&&!flag)return _getResolvedPromise(node);if(flag&&!node.lazy&&!node.hasChildren())return _getResolvedPromise(node);if(!flag&&node.getLevel()<opts.minExpandLevel)return _getRejectedPromise(node,["locked"]);if(!noEvents&&!1===this._triggerNodeEvent("beforeExpand",node,ctx.originalEvent))return _getRejectedPromise(node,["rejected"]);if(noAnimation||node.isVisible()||(noAnimation=callOpts.noAnimation=!0),dfd=new $.Deferred,flag&&!node.expanded&&opts.autoCollapse){parents=node.getParentList(!1,!0),prevAC=opts.autoCollapse;try{for(opts.autoCollapse=!1,i=0,l=parents.length;i<l;i++)this._callHook("nodeCollapseSiblings",parents[i],callOpts)}finally{opts.autoCollapse=prevAC}}return dfd.done((function(){var lastChild=node.getLastChild();flag&&opts.autoScroll&&!noAnimation&&lastChild?lastChild.scrollIntoView(!0,{topNode:node}).always((function(){noEvents||ctx.tree._triggerNodeEvent(flag?"expand":"collapse",ctx)})):noEvents||ctx.tree._triggerNodeEvent(flag?"expand":"collapse",ctx)})),_afterLoad=function(callback){var cn=opts._classNames,effect=opts.toggleEffect;if(node.expanded=flag,tree._callHook("nodeRender",ctx,!1,!1,!0),node.ul)if("none"!==node.ul.style.display===!!node.expanded)node.warn("nodeSetExpanded: UL.style.display already set");else{if(effect&&!noAnimation)return $(node.li).addClass(cn.animating),void $(node.ul).addClass(cn.animating).toggle(effect.effect,effect.options,effect.duration,(function(){$(this).removeClass(cn.animating),$(node.li).removeClass(cn.animating),callback()}));node.ul.style.display=node.expanded||!parent?"":"none"}callback()},flag&&node.lazy&&void 0===node.hasChildren()?node.load().done((function(){dfd.notifyWith&&dfd.notifyWith(node,["loaded"]),_afterLoad((function(){dfd.resolveWith(node)}))})).fail((function(errMsg){_afterLoad((function(){dfd.rejectWith(node,["load failed ("+errMsg+")"])}))})):_afterLoad((function(){dfd.resolveWith(node)})),dfd.promise()},nodeSetFocus:function(ctx,flag){var ctx2,tree=ctx.tree,node=ctx.node,opts=tree.options,isInput=!!ctx.originalEvent&&$(ctx.originalEvent.target).is(":input");if(flag=!1!==flag,tree.focusNode){if(tree.focusNode===node&&flag)return;ctx2=$.extend({},ctx,{node:tree.focusNode}),tree.focusNode=null,this._triggerNodeEvent("blur",ctx2),this._callHook("nodeRenderStatus",ctx2)}flag&&(this.hasFocus()||(node.debug("nodeSetFocus: forcing container focus"),this._callHook("treeSetFocus",ctx,!0,{calledByNode:!0})),node.makeVisible({scrollIntoView:!1}),tree.focusNode=node,opts.titlesTabbable?isInput||$(node.span).find(".fancytree-title").focus():0===$(document.activeElement).closest(".fancytree-container").length&&$(tree.$container).focus(),opts.aria&&$(tree.$container).attr("aria-activedescendant",$(node.tr||node.li).uniqueId().attr("id")),this._triggerNodeEvent("focus",ctx),opts.autoScroll&&node.scrollIntoView(),this._callHook("nodeRenderStatus",ctx))},nodeSetSelected:function(ctx,flag,callOpts){callOpts=callOpts||{};var node=ctx.node,tree=ctx.tree,opts=ctx.options,noEvents=!0===callOpts.noEvents,parent=node.parent;if(flag=!1!==flag,!FT.evalOption("unselectable",node,node,opts,!1)){if(node._lastSelectIntent=flag,!!node.selected===flag&&(3!==opts.selectMode||!node.partsel||flag))return flag;if(!noEvents&&!1===this._triggerNodeEvent("beforeSelect",node,ctx.originalEvent))return!!node.selected;flag&&1===opts.selectMode?(tree.lastSelectedNode&&tree.lastSelectedNode.setSelected(!1),node.selected=flag):3!==opts.selectMode||!parent||parent.radiogroup||node.radiogroup?parent&&parent.radiogroup?node.visitSiblings((function(n){n._changeSelectStatusAttrs(flag&&n===node)}),!0):node.selected=flag:(node.selected=flag,node.fixSelection3AfterClick(callOpts)),this.nodeRenderStatus(ctx),tree.lastSelectedNode=flag?node:null,noEvents||tree._triggerNodeEvent("select",ctx)}},nodeSetStatus:function(ctx,status,message,details){var node=ctx.node,tree=ctx.tree;function _setStatusNode(data,type){var firstChild=node.children?node.children[0]:null;return firstChild&&firstChild.isStatusNode()?($.extend(firstChild,data),firstChild.statusNodeType=type,tree._callHook("nodeRenderTitle",firstChild)):(node._setChildren([data]),node.children[0].statusNodeType=type,tree.render()),node.children[0]}switch(status){case"ok":!function(){var firstChild=node.children?node.children[0]:null;if(firstChild&&firstChild.isStatusNode()){try{node.ul&&(node.ul.removeChild(firstChild.li),firstChild.li=null)}catch(e){}1===node.children.length?node.children=[]:node.children.shift()}}(),node._isLoading=!1,node._error=null,node.renderStatus();break;case"loading":node.parent||_setStatusNode({title:tree.options.strings.loading+(message?" ("+message+")":""),checkbox:!1,tooltip:details},status),node._isLoading=!0,node._error=null,node.renderStatus();break;case"error":_setStatusNode({title:tree.options.strings.loadError+(message?" ("+message+")":""),checkbox:!1,tooltip:details},status),node._isLoading=!1,node._error={message:message,details:details},node.renderStatus();break;case"nodata":_setStatusNode({title:tree.options.strings.noData,checkbox:!1,tooltip:details},status),node._isLoading=!1,node._error=null,node.renderStatus();break;default:$.error("invalid node status "+status)}},nodeToggleExpanded:function(ctx){return this.nodeSetExpanded(ctx,!ctx.node.expanded)},nodeToggleSelected:function(ctx){var node=ctx.node,flag=!node.selected;return node.partsel&&!node.selected&&!0===node._lastSelectIntent&&(flag=!1,node.selected=!0),node._lastSelectIntent=flag,this.nodeSetSelected(ctx,flag)},treeClear:function(ctx){var tree=ctx.tree;tree.activeNode=null,tree.focusNode=null,tree.$div.find(">ul.fancytree-container").empty(),tree.rootNode.children=null},treeCreate:function(ctx){},treeDestroy:function(ctx){this.$div.find(">ul.fancytree-container").remove(),this.$source&&this.$source.removeClass("fancytree-helper-hidden")},treeInit:function(ctx){var tree=ctx.tree,opts=tree.options;tree.$container.attr("tabindex",opts.tabindex),$.each(TREE_ATTRS,(function(i,attr){void 0!==opts[attr]&&(tree.info("Move option "+attr+" to tree"),tree[attr]=opts[attr],delete opts[attr])})),opts.rtl?tree.$container.attr("DIR","RTL").addClass("fancytree-rtl"):tree.$container.removeAttr("DIR").removeClass("fancytree-rtl"),opts.aria&&(tree.$container.attr("role","tree"),1!==opts.selectMode&&tree.$container.attr("aria-multiselectable",!0)),this.treeLoad(ctx)},treeLoad:function(ctx,source){var metaData,type,$ul,tree=ctx.tree,$container=ctx.widget.element,rootCtx=$.extend({},ctx,{node:this.rootNode});if(tree.rootNode.children&&this.treeClear(ctx),source=source||this.options.source)"string"==typeof source&&$.error("Not implemented");else switch(type=$container.data("type")||"html"){case"html":($ul=$container.find(">ul:first")).addClass("ui-fancytree-source fancytree-helper-hidden"),source=$.ui.fancytree.parseHtml($ul),this.data=$.extend(this.data,_getElementDataAsDict($ul));break;case"json":source=$.parseJSON($container.text()),$container.contents().filter((function(){return 3===this.nodeType})).remove(),$.isPlainObject(source)&&(_assert($.isArray(source.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),metaData=source,source=source.children,delete metaData.children,$.each(TREE_ATTRS,(function(i,attr){void 0!==metaData[attr]&&(tree[attr]=metaData[attr],delete metaData[attr])})),$.extend(tree.data,metaData));break;default:$.error("Invalid data-type: "+type)}return this.nodeLoadChildren(rootCtx,source).done((function(){tree.render(),3===ctx.options.selectMode&&tree.rootNode.fixSelection3FromEndNodes(),tree.activeNode&&tree.options.activeVisible&&tree.activeNode.makeVisible(),tree._triggerTreeEvent("init",null,{status:!0})})).fail((function(){tree.render(),tree._triggerTreeEvent("init",null,{status:!1})}))},treeRegisterNode:function(ctx,add,node){},treeSetFocus:function(ctx,flag,callOpts){var targetNode;(flag=!1!==flag)!==this.hasFocus()&&(this._hasFocus=flag,!flag&&this.focusNode?this.focusNode.setFocus(!1):!flag||callOpts&&callOpts.calledByNode||$(this.$container).focus(),this.$container.toggleClass("fancytree-treefocus",flag),this._triggerTreeEvent(flag?"focusTree":"blurTree"),flag&&!this.activeNode&&(targetNode=this._lastMousedownNode||this.getFirstChild())&&targetNode.setFocus())},treeSetOption:function(ctx,key,value){var tree=ctx.tree,callDefault=!0,callCreate=!1,callRender=!1;switch(key){case"aria":case"checkbox":case"icon":case"minExpandLevel":case"tabindex":callCreate=!0,callRender=!0;break;case"escapeTitles":case"tooltip":callRender=!0;break;case"rtl":!1===value?tree.$container.removeAttr("DIR").removeClass("fancytree-rtl"):tree.$container.attr("DIR","RTL").addClass("fancytree-rtl"),callRender=!0;break;case"source":callDefault=!1,tree._callHook("treeLoad",tree,value),callRender=!0}tree.debug("set option "+key+"="+value+" <"+typeof value+">"),callDefault&&(this.widget._super?this.widget._super.call(this.widget,key,value):$.Widget.prototype._setOption.call(this.widget,key,value)),callCreate&&tree._callHook("treeCreate",tree),callRender&&tree.render(!0,!1)}}),$.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!0,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,debugLevel:null,disabled:!1,enableAspx:!0,escapeTitles:!1,extensions:[],toggleEffect:{effect:"blind",options:{direction:"vertical",scale:"box"},duration:200},generateIds:!1,icon:!0,idPrefix:"ft_",focusOnSelect:!1,keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,quicksearch:!1,rtl:!1,scrollOfs:{top:0,bottom:0},scrollParent:null,selectMode:2,strings:{loading:"Loading...",loadError:"Load error!",moreData:"More...",noData:"No data."},tabindex:"0",titlesTabbable:!1,tooltip:!1,_classNames:{node:"fancytree-node",folder:"fancytree-folder",animating:"fancytree-animating",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",hasChildren:"fancytree-has-children",active:"fancytree-active",selected:"fancytree-selected",expanded:"fancytree-expanded",lazy:"fancytree-lazy",focused:"fancytree-focused",partload:"fancytree-partload",partsel:"fancytree-partsel",radio:"fancytree-radio",unselectable:"fancytree-unselectable",lastsib:"fancytree-lastsib",loading:"fancytree-loading",error:"fancytree-error",statusNodePrefix:"fancytree-statusnode-"},lazyLoad:null,postProcess:null},_create:function(){this.tree=new Fancytree(this),this.$source=this.source||"json"===this.element.data("type")?this.element:this.element.find(">ul:first");var extension,extName,i,opts=this.options,extensions=opts.extensions;this.tree;for(i=0;i<extensions.length;i++)extName=extensions[i],(extension=$.ui.fancytree._extensions[extName])||$.error("Could not apply extension '"+extName+"' (it is not registered, did you forget to include it?)"),this.tree.options[extName]=$.extend(!0,{},extension.options,this.tree.options[extName]),_assert(void 0===this.tree.ext[extName],"Extension name must not exist as Fancytree.ext attribute: '"+extName+"'"),this.tree.ext[extName]={},_subclassObject(this.tree,0,extension,extName),extension;void 0!==opts.icons&&(!0!==opts.icon?$.error("'icons' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'icons' tree option is deprecated since v2.14.0: use 'icon' instead"),opts.icon=opts.icons)),void 0!==opts.iconClass&&(opts.icon?$.error("'iconClass' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'iconClass' tree option is deprecated since v2.14.0: use 'icon' instead"),opts.icon=opts.iconClass)),void 0!==opts.tabbable&&(opts.tabindex=opts.tabbable?"0":"-1",this.tree.warn("'tabbable' tree option is deprecated since v2.17.0: use 'tabindex='"+opts.tabindex+"' instead")),this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree),this._bind()},_setOption:function(key,value){return this.tree._callHook("treeSetOption",this.tree,key,value)},destroy:function(){this._unbind(),this.tree._callHook("treeDestroy",this.tree),$.Widget.prototype.destroy.call(this)},_unbind:function(){var ns=this.tree._ns;this.element.off(ns),this.tree.$container.off(ns),$(document).off(ns)},_bind:function(){var that=this,opts=this.options,tree=this.tree,ns=tree._ns;this._unbind(),tree.$container.on("focusin"+ns+" focusout"+ns,(function(event){var node=FT.getNode(event),flag="focusin"===event.type;if(!flag&&node&&$(event.target).is("a"))node.debug("Ignored focusout on embedded <a> element.");else{if(flag){if(tree._getExpiringValue("focusin"))return void tree.info("Ignored double focusin.");tree._setExpiringValue("focusin",!0,50),node||(node=tree._getExpiringValue("mouseDownNode"))&&tree.info("Reconstruct mouse target for focusin from recent event.")}node?tree._callHook("nodeSetFocus",tree._makeHookContext(node,event),flag):tree.tbody&&$(event.target).parents("table.fancytree-container > thead").length?tree.debug("Ignore focus event outside table body.",event):tree._callHook("treeSetFocus",tree,flag)}})).on("selectstart"+ns,"span.fancytree-title",(function(event){event.preventDefault()})).on("keydown"+ns,(function(event){if(opts.disabled||!1===opts.keyboard)return!0;var res,node=tree.focusNode,ctx=tree._makeHookContext(node||tree,event),prevPhase=tree.phase;try{return tree.phase="userEvent","preventNav"===(res=node?tree._triggerNodeEvent("keydown",node,event):tree._triggerTreeEvent("keydown",event))?res=!0:!1!==res&&(res=tree._callHook("nodeKeydown",ctx)),res}finally{tree.phase=prevPhase}})).on("mousedown"+ns,(function(event){var et=FT.getEventTarget(event);tree._lastMousedownNode=et?et.node:null,tree._setExpiringValue("mouseDownNode",tree._lastMousedownNode)})).on("click"+ns+" dblclick"+ns,(function(event){if(opts.disabled)return!0;var ctx,et=FT.getEventTarget(event),node=et.node,tree=that.tree,prevPhase=tree.phase;if(!node)return!0;ctx=tree._makeHookContext(node,event);try{switch(tree.phase="userEvent",event.type){case"click":return ctx.targetType=et.type,node.isPagingNode()?!0===tree._triggerNodeEvent("clickPaging",ctx,event):!1!==tree._triggerNodeEvent("click",ctx,event)&&tree._callHook("nodeClick",ctx);case"dblclick":return ctx.targetType=et.type,!1!==tree._triggerNodeEvent("dblclick",ctx,event)&&tree._callHook("nodeDblclick",ctx)}}finally{tree.phase=prevPhase}}))},getActiveNode:function(){return this.tree.activeNode},getNodeByKey:function(key){return this.tree.getNodeByKey(key)},getRootNode:function(){return this.tree.rootNode},getTree:function(){return this.tree}}),FT=$.ui.fancytree,$.extend($.ui.fancytree,{version:"@VERSION",buildType:"development",debugLevel:4,_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:Fancytree,_FancytreeNodeClass:FancytreeNode,jquerySupports:{positionMyOfs:function(dottedVersion,major,minor,patch){var i,v,t,verParts=$.map($.trim(dottedVersion).split("."),(function(e){return parseInt(e,10)})),testParts=$.map(Array.prototype.slice.call(arguments,1),(function(e){return parseInt(e,10)}));for(i=0;i<testParts.length;i++)if((v=verParts[i]||0)!==(t=testParts[i]||0))return v>t;return!0}($.ui.version,1,9)},assert:function(cond,msg){return _assert(cond,msg)},createTree:function(el,opts){return $(el).fancytree(opts).fancytree("getTree")},debounce:function(timeout,fn,invokeAsap,ctx){var timer;return 3===arguments.length&&"boolean"!=typeof invokeAsap&&(ctx=invokeAsap,invokeAsap=!1),function(){var args=arguments;ctx=ctx||this,invokeAsap&&!timer&&fn.apply(ctx,args),clearTimeout(timer),timer=setTimeout((function(){invokeAsap||fn.apply(ctx,args),timer=null}),timeout)}},debug:function(msg){$.ui.fancytree.debugLevel>=4&&consoleApply("log",arguments)},error:function(msg){$.ui.fancytree.debugLevel>=1&&consoleApply("error",arguments)},escapeHtml:function(s){return(""+s).replace(REX_HTML,(function(s){return ENTITY_MAP[s]}))},fixPositionOptions:function(opts){if((opts.offset||(""+opts.my+opts.at).indexOf("%")>=0)&&$.error("expected new position syntax (but '%' is not supported)"),!$.ui.fancytree.jquerySupports.positionMyOfs){var myParts=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(opts.my),atParts=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(opts.at),dx=(myParts[2]?+myParts[2]:0)+(atParts[2]?+atParts[2]:0),dy=(myParts[4]?+myParts[4]:0)+(atParts[4]?+atParts[4]:0);opts=$.extend({},opts,{my:myParts[1]+" "+myParts[3],at:atParts[1]+" "+atParts[3]}),(dx||dy)&&(opts.offset=dx+" "+dy)}return opts},getEventTarget:function(event){var $target,tcn=event&&event.target?event.target.className:"",res={node:this.getNode(event.target),type:void 0};return/\bfancytree-title\b/.test(tcn)?res.type="title":/\bfancytree-expander\b/.test(tcn)?res.type=!1===res.node.hasChildren()?"prefix":"expander":/\bfancytree-checkbox\b/.test(tcn)?res.type="checkbox":/\bfancytree(-custom)?-icon\b/.test(tcn)?res.type="icon":/\bfancytree-node\b/.test(tcn)?res.type="title":event&&event.target&&(($target=$(event.target)).is("ul[role=group]")?(FT.info("Ignoring click on outer UL."),res.node=null):$target.closest(".fancytree-title").length?res.type="title":$target.closest(".fancytree-checkbox").length?res.type="checkbox":$target.closest(".fancytree-expander").length&&(res.type="expander")),res},getEventTargetType:function(event){return this.getEventTarget(event).type},getNode:function(el){if(el instanceof FancytreeNode)return el;for(el instanceof $?el=el[0]:void 0!==el.originalEvent&&(el=el.target);el;){if(el.ftnode)return el.ftnode;el=el.parentNode}return null},getTree:function(el){var widget;return el instanceof Fancytree?el:(void 0===el&&(el=0),"number"==typeof el?el=$(".fancytree-container").eq(el):"string"==typeof el?el=$(el).eq(0):void 0!==el.selector?el=el.eq(0):void 0!==el.originalEvent&&(el=$(el.target)),(widget=(el=el.closest(":ui-fancytree")).data("ui-fancytree")||el.data("fancytree"))?widget.tree:null)},evalOption:function(optionName,node,nodeObject,treeOptions,defaultValue){var ctx,res,tree=node.tree,treeOpt=treeOptions[optionName],nodeOpt=nodeObject[optionName];return $.isFunction(treeOpt)?(ctx={node:node,tree:tree,widget:tree.widget,options:tree.widget.options,typeInfo:tree.types[node.type]||{}},null==(res=treeOpt.call(tree,{type:optionName},ctx))&&(res=nodeOpt)):res=null!=nodeOpt?nodeOpt:treeOpt,null==res&&(res=defaultValue),res},setSpanIcon:function(span,baseClass,icon){var $span=$(span);"string"==typeof icon?$span.attr("class",baseClass+" "+icon):(icon.text?$span.text(""+icon.text):icon.html&&(span.innerHTML=icon.html),$span.attr("class",baseClass+" "+(icon.addClass||"")))},eventToString:function(event){var which=event.which,et=event.type,s=[];return event.altKey&&s.push("alt"),event.ctrlKey&&s.push("ctrl"),event.metaKey&&s.push("meta"),event.shiftKey&&s.push("shift"),"click"===et||"dblclick"===et?s.push(MOUSE_BUTTONS[event.button]+et):IGNORE_KEYCODES[which]||s.push(SPECIAL_KEYCODES[which]||String.fromCharCode(which).toLowerCase()),s.join("+")},info:function(msg){$.ui.fancytree.debugLevel>=3&&consoleApply("info",arguments)},keyEventToString:function(event){return this.warn("keyEventToString() is deprecated: use eventToString()"),this.eventToString(event)},overrideMethod:function(instance,methodName,handler){var prevSuper,_super=instance[methodName]||$.noop;instance[methodName]=function(){try{return prevSuper=this._super,this._super=_super,handler.apply(this,arguments)}finally{this._super=prevSuper}}},parseHtml:function($ul){var classes,className,extraClasses,i,iPos,l,tmp,tmp2,$children=$ul.find(">li"),children=[];return $children.each((function(){var allData,lowerCaseAttr,$li=$(this),$liSpan=$li.find(">span:first",this),$liA=$liSpan.length?null:$li.find(">a:first"),d={tooltip:null,data:{}};for($liSpan.length?d.title=$liSpan.html():$liA&&$liA.length?(d.title=$liA.html(),d.data.href=$liA.attr("href"),d.data.target=$liA.attr("target"),d.tooltip=$liA.attr("title")):(d.title=$li.html(),(iPos=d.title.search(/<ul/i))>=0&&(d.title=d.title.substring(0,iPos))),d.title=$.trim(d.title),i=0,l=CLASS_ATTRS.length;i<l;i++)d[CLASS_ATTRS[i]]=void 0;for(classes=this.className.split(" "),extraClasses=[],i=0,l=classes.length;i<l;i++)className=classes[i],CLASS_ATTR_MAP[className]?d[className]=!0:extraClasses.push(className);if(d.extraClasses=extraClasses.join(" "),(tmp=$li.attr("title"))&&(d.tooltip=tmp),(tmp=$li.attr("id"))&&(d.key=tmp),$li.attr("hideCheckbox")&&(d.checkbox=!1),(allData=_getElementDataAsDict($li))&&!$.isEmptyObject(allData)){for(lowerCaseAttr in NODE_ATTR_LOWERCASE_MAP)allData.hasOwnProperty(lowerCaseAttr)&&(allData[NODE_ATTR_LOWERCASE_MAP[lowerCaseAttr]]=allData[lowerCaseAttr],delete allData[lowerCaseAttr]);for(i=0,l=NODE_ATTRS.length;i<l;i++)tmp=NODE_ATTRS[i],null!=(tmp2=allData[tmp])&&(delete allData[tmp],d[tmp]=tmp2);$.extend(d.data,allData)}($ul=$li.find(">ul:first")).length?d.children=$.ui.fancytree.parseHtml($ul):d.children=d.lazy?void 0:null,children.push(d)})),children},registerExtension:function(definition){_assert(null!=definition.name,"extensions must have a `name` property."),_assert(null!=definition.version,"extensions must have a `version` property."),$.ui.fancytree._extensions[definition.name]=definition},unescapeHtml:function(s){var e=document.createElement("div");return e.innerHTML=s,0===e.childNodes.length?"":e.childNodes[0].nodeValue},warn:function(msg){$.ui.fancytree.debugLevel>=2&&consoleApply("warn",arguments)}}),$.ui.fancytree}function _assert(cond,msg){cond||(msg=msg?": "+msg:"",$.error("Fancytree assertion failed"+msg))}function consoleApply(method,args){var i,s,fn=window.console?window.console[method]:null;if(fn)try{fn.apply(window.console,args)}catch(e){for(s="",i=0;i<args.length;i++)s+=args[i];fn(s)}}function _makeVirtualFunction(methodName,tree,base,extension,extName){var prevFunc,baseFunc,_local,_super,_superApply,proxy=(prevFunc=tree[methodName],baseFunc=extension[methodName],_local=tree.ext[extName],_super=function(){return prevFunc.apply(tree,arguments)},_superApply=function(args){return prevFunc.apply(tree,args)},function(){var prevLocal=tree._local,prevSuper=tree._super,prevSuperApply=tree._superApply;try{return tree._local=_local,tree._super=_super,tree._superApply=_superApply,baseFunc.apply(tree,arguments)}finally{tree._local=prevLocal,tree._super=prevSuper,tree._superApply=prevSuperApply}});return proxy}function _subclassObject(tree,base,extension,extName){for(var attrName in extension)"function"==typeof extension[attrName]?"function"==typeof tree[attrName]?tree[attrName]=_makeVirtualFunction(attrName,tree,0,extension,extName):"_"===attrName.charAt(0)?tree.ext[extName][attrName]=_makeVirtualFunction(attrName,tree,0,extension,extName):$.error("Could not override tree."+attrName+". Use prefix '_' to create tree."+extName+"._"+attrName):"options"!==attrName&&(tree.ext[extName][attrName]=extension[attrName])}function _getResolvedPromise(context,argArray){return void 0===context?$.Deferred((function(){this.resolve()})).promise():$.Deferred((function(){this.resolveWith(context,argArray)})).promise()}function _getRejectedPromise(context,argArray){return void 0===context?$.Deferred((function(){this.reject()})).promise():$.Deferred((function(){this.rejectWith(context,argArray)})).promise()}function _makeResolveFunc(deferred,context){return function(){deferred.resolveWith(context)}}function _getElementDataAsDict($el){var d=$.extend({},$el.data()),json=d.json;return delete d.fancytree,delete d.uiFancytree,json&&(delete d.json,d=$.extend(d,json)),d}function _escapeTooltip(s){return(""+s).replace(REX_TOOLTIP,(function(s){return ENTITY_MAP[s]}))}function _makeNodeTitleMatcher(s){return s=s.toLowerCase(),function(node){return node.title.toLowerCase().indexOf(s)>=0}}function FancytreeNode(parent,obj){var i,l,name,cl;for(this.parent=parent,this.tree=parent.tree,this.ul=null,this.li=null,this.statusNodeType=null,this._isLoading=!1,this._error=null,this.data={},i=0,l=NODE_ATTRS.length;i<l;i++)this[name=NODE_ATTRS[i]]=obj[name];for(name in null==this.unselectableIgnore&&null==this.unselectableStatus||(this.unselectable=!0),obj.hideCheckbox&&$.error("'hideCheckbox' node option was removed in v2.23.0: use 'checkbox: false'"),obj.data&&$.extend(this.data,obj.data),obj)NODE_ATTR_MAP[name]||$.isFunction(obj[name])||NONE_NODE_DATA_MAP[name]||(this.data[name]=obj[name]);null==this.key?this.tree.options.defaultKey?(this.key=this.tree.options.defaultKey(this),_assert(this.key,"defaultKey() must return a unique key")):this.key="_"+FT._nextNodeKey++:this.key=""+this.key,obj.active&&(_assert(null===this.tree.activeNode,"only one active node allowed"),this.tree.activeNode=this),obj.selected&&(this.tree.lastSelectedNode=this),(cl=obj.children)?cl.length?this._setChildren(cl):this.children=this.lazy?[]:null:this.children=null,this.tree._callHook("treeRegisterNode",this.tree,!0,this)}function Fancytree(widget){this.widget=widget,this.$div=widget.element,this.options=widget.options,this.options&&($.isFunction(this.options.lazyload)&&!$.isFunction(this.options.lazyLoad)&&(this.options.lazyLoad=function(){return FT.warn("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead."),widget.options.lazyload.apply(this,arguments)}),$.isFunction(this.options.loaderror)&&$.error("The 'loaderror' event was renamed since 2014-07-03. Use 'loadError' (with uppercase E) instead."),void 0!==this.options.fx&&FT.warn("The 'fx' option was replaced by 'toggleEffect' since 2014-11-30."),void 0!==this.options.removeNode&&$.error("The 'removeNode' event was replaced by 'modifyChild' since 2.20 (2016-09-10).")),this.ext={},this.types={},this.columns={},this.data=_getElementDataAsDict(this.$div),this._id=$.ui.fancytree._nextId++,this._ns=".fancytree-"+this._id,this.activeNode=null,this.focusNode=null,this._hasFocus=null,this._tempCache={},this._lastMousedownNode=null,this._enableUpdate=!0,this.lastSelectedNode=null,this.systemFocusElement=null,this.lastQuicksearchTerm="",this.lastQuicksearchTime=0,this.statusClassPropName="span",this.ariaPropName="li",this.nodeContainerAttrName="li",this.$div.find(">ul.fancytree-container").remove();var $ul,fakeParent={tree:this};this.rootNode=new FancytreeNode(fakeParent,{title:"root",key:"root_"+this._id,children:null,expanded:!0}),this.rootNode.parent=null,$ul=$("<ul>",{class:"ui-fancytree fancytree-container fancytree-plain"}).appendTo(this.$div),this.$container=$ul,this.rootNode.ul=$ul[0],null==this.options.debugLevel&&(this.options.debugLevel=FT.debugLevel)}$.ui.fancytree.warn("Fancytree: ignored duplicate include")}));