const EditModal=new Vue({el:"#edit-modal-container",data:()=>({modalTitle:EDIT_BOOKMARK_TEXT,bookmark:{id:"",title:"",url:"",parent:"0",isFolder:!1},existingBookmark:!1,visible:!1,editedTitle:"",tree:{},error:{title:"",url:""},shouldSync:!1,firstInput:!0,isShowNewFolder:!1,isConfirmClicked:!1,targetNode:{},disabled:!1}),mounted(){EventBus.$on("firstSelectLeaf",(leaf=>{this.disabled=this.targetNode.data&&leaf==this.targetNode.data.id,this.bookmark.isFolder||(this.bookmark.parent=leaf)})),EventBus.$on("selectLeaf",(leaf=>{this.error.title="",this.error.url="",this.bookmark.parent=leaf,this.disabled=this.targetNode.data&&leaf==this.targetNode.data.id})),EventBus.$on("isShowNewFolder",(isShowNewFolder=>{this.isShowNewFolder=isShowNewFolder,!isShowNewFolder&&this.isConfirmClicked&&(this.isConfirmClicked=!1,this.confirm())})),EventBus.$on("newFolderInfo",(newFolderInfo=>{if(this.visible){this.shouldSync=!0;var parentNode=getNodeById(parseInt(newFolderInfo.parent)),node=addNewNode(parentNode,newFolderInfo);EditModal.bookmark.key=node.key}}))},updated(){this.firstInput&&this.bookmark.title&&(document.getElementById("editTitleInput").select(),this.firstInput=!1)},methods:{toggle(){this.visible=!this.visible,this.visible||(this.firstInput=!0)},async confirm(){if(this.isShowNewFolder)return void(this.isConfirmClicked=!0);let hasErrors=!1;this.bookmark.title||(this.error.title=TITLE_EMPTY,hasErrors=!0),this.bookmark.isFolder||(this.bookmark.url||(this.error.url=URL_EMPTY,hasErrors=!0),isBrowserURL(this.bookmark.url)&&(this.error.url=URL_INVALID,hasErrors=!0));const doesSimilarExist=await checkSimilarBookmark(this.bookmark);if(doesSimilarExist&&this.existingBookmark)return this.toggle();doesSimilarExist&&(this.error.title=BOOKMARK_EXISTS,hasErrors=!0),hasErrors||(this.existingBookmark?(await updateBookmark(this.bookmark),updateBookmarkCallback(this.targetNode,this.bookmark)):this.bookmark.isFolder?await createFolder(this.bookmark):(await addBookmark(this.bookmark),addNodeNewBookmark(this.bookmark)),doBookmarkSync(),this.toggle())},createFolder(){EventBus.$emit("showNewFolder",this.bookmark.parent)},async updateFolderTree(){this.tree={children:[await getDBBookmarkTree()]}},focusInputForTitle(){this.error.title&&(this.error.title="")},focusInputForUrl(){this.error.url&&(this.error.url="")}},watch:{async visible(isVisible){if(await storageLocalApi.setItem(IS_MODAL_OPENED,!!isVisible),this.tree={},!isVisible)return this.bookmark={title:"",url:"",isFolder:!1,parent:0},this.isShowNewFolder=!1,this.error={title:"",url:""},this.existingBookmark=!1,void(this.shouldSync&&(doBookmarkSync(),this.shouldSync=!1));if(this.modalTitle=this.bookmark.isFolder?EDIT_FOLDER_TEXT:EDIT_BOOKMARK_TEXT,await this.updateFolderTree(),this.bookmark.title)return void(this.existingBookmark=!0);this.modalTitle=ADD_TO_BOOKMARKS_TEXT;const{title:title,url:url}=await getActiveTab();this.bookmark.title=""==this.editedTitle?title:this.editedTitle,this.bookmark.url=url;await checkSimilarBookmark(this.bookmark)&&(this.error.title=BOOKMARK_EXISTS),isBrowserURL(this.bookmark.url)&&(this.error.url=URL_INVALID)}}});