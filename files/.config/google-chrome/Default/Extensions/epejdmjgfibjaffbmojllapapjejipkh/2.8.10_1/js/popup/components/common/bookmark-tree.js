Vue.directive("focus",{inserted:function(el){el.focus()}}),Vue.component("leaf",{name:"leaf",props:["leaf"],template:"#bookmark-leaf",data:()=>({expanded:!1,selected:!1,showNewFolder:!1,newFolderTitle:NEW_FOLDER_TEXT,error:"",preventSelect:!1}),mounted(){parseInt(this.leaf.id)===parseInt(ROOT_FOLDER_ID)&&(this.expanded=!0),EventBus.$on("selectLeaf",(id=>{if(parseInt(this.leaf.id)===parseInt(id)){this.selected=!0;let node=this.$parent;for(;"leaf"===node.$options.name;)node.expanded=!0,node=node.$parent}else this.selected=!1})),EventBus.$on("firstSelectLeaf",(id=>{if(parseInt(this.leaf.id)===parseInt(id)){this.selected=!0;let node=this.$parent;for(;"leaf"===node.$options.name;)node.expanded=!0,node=node.$parent}else this.selected=!1})),EventBus.$on("targetLeaf",(bookmarks=>{(bookmarks?Array.isArray(bookmarks)?bookmarks:[bookmarks]:[]).map((bookmark=>bookmark.data?bookmark.data.id:bookmark.id)).indexOf(this.leaf.id)>=0?this.preventSelect=!0:this.preventSelect=!1})),EventBus.$on("showNewFolder",(async id=>{if(this.selected=!1,parseInt(this.leaf.id)===parseInt(id)){const folders=await getSubFolders(this.leaf.id);this.newFolderTitle=getFolderName(folders,NEW_FOLDER_TEXT),this.showNewFolder=!0,this.expanded=!0,EventBus.$emit("isShowNewFolder",!0)}}))},methods:{toggle(){this.leaf.children&&this.leaf.children.length&&(this.expanded=!this.expanded)},selectLeaf(){this.leaf.id!=IMPORTED_MAIN_FOLDER_IDS.BOOKMARKS&&(this.toggle(),EventBus.$emit("selectLeaf",this.leaf.id))},async addNewFolderByEvent(e){if(e.relatedTarget&&e.relatedTarget.className&&e.relatedTarget.className.indexOf("modal-button-cancel")>=0)return void EventBus.$emit("isShowNewFolder",!1);let newFolderInfo={parent:this.leaf.id,title:this.newFolderTitle,isFolder:1};await checkSimilarBookmark(newFolderInfo)?this.error=FOLDER_NAME_EXISTS:this.addNewFolder().then((id=>{EventBus.$emit("selectLeaf",id),EventBus.$emit("isShowNewFolder",!1),newFolderInfo.id=id,EventBus.$emit("newFolderInfo",newFolderInfo)}))},onChangeFolderName(){this.error=""},async addNewFolder(){if(!this.showNewFolder)return;const folders=await getSubFolders(this.leaf.id);this.newFolderTitle=getFolderName(folders,this.newFolderTitle?this.newFolderTitle:NEW_FOLDER_TEXT);const id=await createFolder({title:this.newFolderTitle,parent:this.leaf.id});return this.leaf.children=this.leaf.children||[],this.leaf.children.push({id:id,title:this.newFolderTitle,parent:this.leaf.id,children:[]}),this.showNewFolder=!1,new Promise((resolve=>resolve(id)))}}}),Vue.component("tree",{template:"#bookmark-tree",props:["tree","selected","target"],data:()=>({selectedLeaf:ROOT_FOLDER_ID}),mounted(){setTimeout((()=>{EventBus.$emit("firstSelectLeaf",this.target.isFolder?this.target.id:this.selected),EventBus.$emit("targetLeaf",this.target)}),100)}});