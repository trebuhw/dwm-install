(()=>{let pwList=[],filterUsername="",originUrl="";window.addEventListener("load",(event=>{chrome.runtime.sendMessage({cmd:"GET_HOST_URL"},(res=>{originUrl=res.hostUrl.replace("www.","").replace("http://","").replace("https://",""),originUrl.length&&"/"!==originUrl[originUrl.length-1]&&(originUrl+="/"),chrome.runtime.onMessage.addListener(((msg,sender,sendResponse)=>{const{cmd:cmd,filter:filter,data:data}=msg;if(filterUsername=filter||"","SHOW_AUTOFILL_CREDENTIALS_FILTERED"===cmd)pwList=data||[],function(){const pwListElement=document.getElementById("pw-list"),syncLoaderContainer=document.getElementById("syncLoaderContainer");if(syncLoaderContainer.style.display="none",pwList&&pwList.length){const pwListItems=pwList.map(((credential,index)=>{const liElement=document.createElement("li");liElement.className="pw-item",liElement.dataset.index=index;const iconBlock=document.createElement("div");iconBlock.className="icon-block";const iconSpan=document.createElement("span");iconSpan.className="thumbnail icon-text",iconSpan.innerText=url2title(credential.hostUrl).substr(0,1).toUpperCase();const imgElement=document.createElement("img");imgElement.className="pw-item-img",imgElement.dataset.index=index,imgElement.src=`${credential.hostUrl}/favicon.ico`,imgElement.addEventListener("load",(ev=>{ev.currentTarget.parentElement.querySelector(".icon-text").remove()})),imgElement.addEventListener("error",(ev=>{ev.currentTarget.remove()})),iconBlock.appendChild(iconSpan),iconBlock.appendChild(imgElement);const usernameElement=document.createElement("div");usernameElement.className="pw-item-username",usernameElement.dataset.index=index,usernameElement.innerHTML=credential.username,usernameElement.title=credential.username;const usernameBlock=document.createElement("div");usernameBlock.className="pw-item-username-area",usernameBlock.dataset.index=index,usernameBlock.appendChild(usernameElement);let hostUrl=credential.hostUrl.replace("www.","").replace("http://","").replace("https://","");if(hostUrl.length&&"/"!==hostUrl[hostUrl.length-1]&&(hostUrl+="/"),hostUrl!==originUrl){const websiteElement=document.createElement("div");websiteElement.className="pw-item-website",websiteElement.dataset.index=index,websiteElement.innerHTML=credential.hostUrl,websiteElement.title=credential.hostUrl,usernameBlock.appendChild(websiteElement)}return liElement.appendChild(iconBlock),liElement.appendChild(usernameBlock),liElement}));pwListElement.innerHTML="",pwListElement.append(...pwListItems)}else pwListElement.innerHTML="",syncLoaderContainer.style.display="block"}()})),chrome.runtime.sendMessage({cmd:"GET_CREDENTIAL_FROM_AUTOFILL"})})),document.getElementById("pw-list").addEventListener("click",selectPassword),document.getElementById("viewAll").addEventListener("click",(()=>{const iframeRemove=document.getElementById("frameIM");iframeRemove&&iframeRemove.parentElement.removeChild(iframeRemove);const newIframe=document.createElement("iframe");newIframe.id="frameIM",newIframe.style="display: none;",newIframe.src=`com.samsung-pass://?token=${Date.now()}`,document.body.appendChild(newIframe)}))}));const url2title=href=>{let hostname=href;switch(hostname=hostname.replace("www.","").replace("http://","").replace("https://",""),hostname=hostname.split("."),hostname.length){case 1:case 2:return hostname[0];default:return hostname.slice(-2)[0]}};function selectPassword(ev){const index=ev.target.dataset.index;index>=0&&chrome.runtime.sendMessage({cmd:"FILL_CREDENTIAL",from:"",data:pwList[index]})}})();