function getNodeById(id){return folderTree.findFirst((function(item){return item.data.id==id}))}function getParentId(node){return node.parent&&node.parent.data&&node.parent.data.id?node.parent.data.id:"object"==typeof node.data.parent?node.data.parent.data.id:node.data.parent}function getChildrenNodes(node){return"object"==typeof node.data.parent?node.data.parent.children:[]}function getAllURLSelected(){let urls=[];return selectedNodes.forEach((_node=>{const node=getNodeById(_node.data.id);if(node.hasChildren())for(let i=0;i<node.children.length;i++)1!=node.children[i].folder&&urls.push(node.children[i].data.url);else 1!=node.folder&&urls.push(node.data.url)})),urls}function hasSelectedFolder(){return selectedNodes.some((node=>1==node.folder))}function disableMovingSelectedNode(event){return[KEYS.LEFT_ARROW,KEYS.RIGHT_ARROW,KEYS.DOWN_ARROW,KEYS.UP_ARROW].indexOf(event.which)>=0}function copySelectedNodes(){if(!hasSelectedFolder()){copyingNodes=selectedNodes.map((node=>node));var $temp=$("<textarea>"),urls="";$("body").append($temp),copyingNodes.forEach((node=>urls+=node.data.url+"\n")),$temp.val(urls).select(),document.execCommand("copy"),$temp.remove(),showNotice(`${1==selectedNodes.length?ONE_ITEM_COPIED:getTextForCount("IDS_MF_POP_PD_ITEMS_COPIED",selectedNodes.length)}`),setTimeout(removeNotice,3e3),closeEditMode()}}const notifyContainer=document.querySelector(".notifyContainer");function getCuttingNodes(){hasSelectedFolder()||(cuttingNodes=selectedNodes.map((node=>node)))}function pasteBookmarksCallBack(parent){var parentNode=getNodeById(parent);cuttingNodes.forEach((node=>{getNodeById(node.data.id).moveTo(parentNode)})),refreshMainTreeContent(parent),cuttingNodes=[],selectedNodes=[]}function deleteMultiBookmarkOrTab(node){var parentId=getParentId(node),active=getNodeById(parentId),children=[],nodeIndex=null;originChildrenNodes=null,originChildrenNodes=$.extend({},active.getChildren());var deleteNodes=$.extend([],selectedNodes);for(let node of selectedNodes)nodeIndex=node.getIndex(),children=$.extend([],getNodeById(node.data.id).getChildren()),folderTree.getNodeByKey(node.key).remove(),children&&originChildrenNodes[nodeIndex]&&!originChildrenNodes[nodeIndex].getChildren()&&originChildrenNodes[nodeIndex].addChildren(children);showNotice(`${1==selectedNodes.length?ONE_ITEM_DELETED:getTextForCount("DREAM_CLOUD_TPOP_PD_ITEMS_DELETED",selectedNodes.length)}`,MenuContentView.texts.UNDO,"normal"),closeEditMode(),deleteTimeout=setTimeout((function(){removeNotice(),"bookmark"===node.type?removeSelectedBookmarks_fancytree(deleteNodes):removeSelectedTabs_fancytree(deleteNodes)}),3e3),updateSourcePosition(node.data.parent.children),"bookmark"===node.type||node.data.parent.children?refreshMainTreeContent(parentId):originNode=null}function updateBookmarkCallback(node,bookmark){var updatedNode=getNodeById(node.data.id),oldParentId=getParentId(node);if(console.log("(updateBookmarkCallback) bookmark: ",JSON.stringify(bookmark)),updatedNode.setTitle(bookmark.title),updatedNode.data.url=bookmark.url,oldParentId!==bookmark.parent){var parentId=bookmark.parent,newParentNode=folderTree.findFirst((function(item){return item.data.id==parentId}));if(newParentNode||(newParentNode=folderTree.getNodeByKey(bookmark.key)),updatedNode.moveTo(newParentNode),originNode&&originNode.data.id==bookmark.id){var oldParentNode=getNodeById(oldParentId);originNode=oldParentNode}console.log("(updateBookmarkCallback) newParentNode: ",newParentNode.title,"Children: ",(newParentNode.getChildren()||[]).toString())}console.log("(updateBookmarkCallback) updatedNode: ",updatedNode.info("url: ",updatedNode.data.url)),closeEditMode(),MenuContentView.searchResultsEnabled&&MenuContentView.triggerSearch(),viewNode(originNode?getNodeById(originNode.data.id):getNodeById(0))}function onHandleKeyMappingEvent(activeNode){if(activeNode&&"bookmark"===activeNode.type&&(86==event.keyCode&&event.ctrlKey&&(cuttingNodes.length?onPasteBookmarks_fancytree(cuttingNodes,activeNode.data.id):copyingNodes.length&&onPasteCopiedBookmarks(copyingNodes,activeNode.data.id)),67==event.keyCode&&event.ctrlKey&&selectedNodes.length&&copySelectedNodes(),88==event.keyCode&&event.ctrlKey&&selectedNodes.length&&getCuttingNodes()),65==event.keyCode&&event.ctrlKey){let _originNode=getNodeById(originNode.data.id);if(MenuContentView.isSearchEnabled||!_originNode||!_originNode.children||0==_originNode.children.length||"true"==storageLocalApi.getItem("IS_MODAL_OPENED"))return;MenuContentView.isOpenEditBar||MenuContentView.toggleEditBar(!0),selectAllBookmark(!0)}46==event.keyCode&&(selectedNodes.length>1?deleteMultiBookmarkOrTab(selectedNodes[0]):1===selectedNodes.length&&deleteBookmarkOrTab(selectedNodes[0]))}notifyContainer&&notifyContainer.addEventListener("animationend",(ev=>{"fadeout"==ev.animationName&&document.getElementById("notifyContainer").classList.remove("show")}));