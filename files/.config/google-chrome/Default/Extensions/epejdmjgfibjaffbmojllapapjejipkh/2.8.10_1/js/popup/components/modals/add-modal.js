const ROOT_FOLDER={value:ROOT_FOLDER_ID,title:ROOT_BOOKMARK_FOLDER_NAME,class:"option"},AddModal=new Vue({el:"#add-modal-container",data:()=>({modalTitle:ADD_TO_BOOKMARKS_TEXT,bookmark:{title:"",url:"",parent:0,isFolder:!1},visible:!1,folders:[],error:"",firstInput:!0}),updated(){this.visible&&this.firstInput&&this.bookmark.title&&(document.getElementById("addTitleInput").select(),this.firstInput=!1)},methods:{toggle(){this.visible=!this.visible,this.folders=[]},async confirm(){if(this.bookmark.title=this.bookmark.title.trim(),!this.bookmark.title)return void(this.error=TITLE_EMPTY);if(isBrowserURL(this.bookmark.url))return void(this.error=URL_INVALID);await checkSimilarBookmark(this.bookmark)?this.error=BOOKMARK_EXISTS:(await addBookmark(this.bookmark),addNodeNewBookmark(this.bookmark),doBookmarkSync(),this.toggle())},openEdit(){EditModal.bookmark.parent=this.bookmark.parent,EditModal.editedTitle=this.bookmark.title.trim(),EditModal.toggle(),this.toggle()},chooseFolder(option){this.visible&&(this.error=""),"other"===option.value?this.openEdit():this.bookmark.parent=option.value},focusInput(){this.error&&(this.error="")}},computed:{recentFolders(){return this.folders.slice(0,5).concat({title:CHOOSE_OTHER_FOLDER,value:"other",class:"chooseFolder"})}},watch:{async visible(isVisible){if(await storageLocalApi.setItem(IS_MODAL_OPENED,!!isVisible),isVisible){const{title:title,url:url}=await getActiveTab();this.bookmark.title=title,this.bookmark.url=url;const folderResult=Array.from(await DB.Query.bookmarks({selection:["_ID as value","TITLE as title"],where:{equals:[{key:"IS_DELETED",value:"0"},{key:"FOLDER",value:1}]},sortOrder:"MODIFIED DESC"}));folderResult.forEach((n=>{this.folders.push({title:n.title,value:n.value,class:"option"})}));let primaryFolder=ROOT_FOLDER;if(CURRENT_FOLDER_ID){primaryFolder=folderResult.find((folder=>folder.value===CURRENT_FOLDER_ID)),primaryFolder.class="option";const idx=this.folders.findIndex((function(item){return item.value===CURRENT_FOLDER_ID}));idx>-1&&this.folders.splice(idx,1)}this.bookmark.parent=primaryFolder.value,this.folders=[primaryFolder].concat(this.folders);await checkSimilarBookmark(this.bookmark)&&(this.error=BOOKMARK_EXISTS),isBrowserURL(this.bookmark.url)&&(this.error=URL_INVALID)}else this.error="",this.firstInput=!0}}});