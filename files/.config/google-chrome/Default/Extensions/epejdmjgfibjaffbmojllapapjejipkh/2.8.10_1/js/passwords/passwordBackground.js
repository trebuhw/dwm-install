function PasswordBackground(){BrowserUtil.isWin11Up().then((result=>this.isWin11Up=result)),chrome.runtime.onMessage.addListener((async(response,sender,sendResponse)=>{const{cmd:cmd,data:data}=response,tabId=sender.tab?sender.tab.id:null,opts=sender.frameId?{frameId:sender.frameId}:null;switch(SamsungSCloudSyncService.PassLogs.log(`background message: sender: ${JSON.stringify(sender.tab)}, response: ${JSON.stringify(response)}`),cmd){case"LOGOUT_FROM_POPUP":SamsungSCloudSyncService.passwordService.clearSecureConnection();break;case"UPDATE_PASSWORD_SYNC_STATE":SamsungSCloudSyncService.passwordTabsGlobal.updateStatus(!0);break;case"PASSWORD_ENABLE_STATUS":case"UPDATE_AUTOFILL_PASSWORD_ENABLED":BrowserUtil.tabSendMessage(sender.tab,{data:{enable:this.isPasswordSyncEnable(),autofill:this.isAutoFillPasswordEnabled(),save:this.isSavePasswordEnabled()},cmd:"PASSWORD_ENABLE_STATUS"},opts);break;case"AUTOFILL_PASSWORD_ENABLED":BrowserUtil.tabSendMessage(sender.tab,{data:{enable:this.isAutoFillPasswordEnabled()},cmd:"AUTOFILL_PASSWORD_ENABLED"},opts);break;case"UPDATE_SAVE_PASSWORD_ENABLED":this.setChromePasswordSavingEnabled(!this.isSavePasswordEnabled()),SamsungSCloudSyncService.passwordTabsGlobal.updateStatus(this.isSavePasswordEnabled()),BrowserUtil.tabSendMessage(sender.tab,{data:{enable:this.isPasswordSyncEnable(),autofill:this.isAutoFillPasswordEnabled(),save:this.isSavePasswordEnabled()},cmd:"PASSWORD_ENABLE_STATUS"},opts);break;case"SAVE_PASSWORD_ENABLED":BrowserUtil.tabSendMessage(sender.tab,{data:{enable:this.isSavePasswordEnabled()},cmd:"SAVE_PASSWORD_ENABLED"},opts);break;case"FIND_CONTENT_CREDENTIAL":this.onFindContentCredential(tabId,sender,data),data&&SamsungSCloudSyncService.passwordService.checkPassAppSignedIn();break;case"GET_CREDENTIAL_FROM_AUTOFILL":BrowserUtil.tabSendMessage(sender.tab,{cmd:"GET_CREDENTIAL_FROM_AUTOFILL_BACKGROUND"});break;case"SEND_CREDENTIAL_TO_AUTOFILL":BrowserUtil.tabSendMessage(sender.tab,{cmd:"SHOW_AUTOFILL_CREDENTIALS_FILTERED",data:data});break;case"GET_HOST_URL":let hostUrl="";try{hostUrl=new URL(sender.tab.url).origin,hostUrl&&hostUrl.length&&"/"!=hostUrl[hostUrl.length-1]&&(hostUrl+="/")}catch(error){console.log(error)}sendResponse({hostUrl:hostUrl});break;case"GET_CREDENTIAL_NOTIFICATION":var credential=SamsungSCloudSyncService.passwordTabsGlobal.getCredential(tabId);chrome.tabs.sendMessage(tabId,{cmd:"GET_CREDENTIAL_NOTIFICATION",data:{credential:credential}},opts);break;case"UPDATE_CREDENTIAL":SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId]&&(SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].curCredential?SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].curCredential.update(data):SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].curCredential=new Credential(data));break;case"NEVER_SAVE_PASSWORD":SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId]&&(SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].curCredential=new Credential({}),SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].clearFrameInfo(),this.setNerverSavePasswordNotice(sender.hostUrl));break;case"SAVE_PASSWORD":SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId]&&(SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].curCredential=new Credential({}),SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].clearFrameInfo(!0),SamsungSCloudSyncService.passwordService.saveCredential(data,(result=>{this.onSaveCredentialCalback(result),SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].getCredentialFromPc()})));break;case"UPDATE_PASSWORD":SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId]&&(SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].curCredential=new Credential({}),SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].clearFrameInfo(!0),SamsungSCloudSyncService.passwordService.updateCredential(data,(result=>{this.onUpdateCredentialCalback(result),SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].getCredentialFromPc()})));break;case"CANCEL_SAVE_UPDATE_PASSWORD":response.notShowAgain&&SamsungSCloudSyncService.passwordService.addExcludedWebsite(data.hostUrl);break;case"CLOSE_SAVE_PASSWORD_NOTIFICATION":SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId]&&(chrome.tabs.sendMessage(tabId,{cmd:"CLOSE_SAVE_PASSWORD_NOTIFICATION"}),SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId]&&(SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].curCredential=new Credential({}),SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].clearFrameInfo()));break;case"FILL_CREDENTIAL":this.fillPassword(data,tabId);break;case"REQUEST_CONNECT_NATIVE_PASS_APP":SamsungSCloudSyncService.passwordService.init();break;case"REQUEST_GET_PASS_APP_USER":SamsungSCloudSyncService.passwordService.checkPassAppSignedIn({fromPopup:!0});break;case"VERIFY_SERVER_CERT_SUCCESS":tabId&&chrome.tabs.sendMessage(tabId,{cmd:"VERIFY_SERVER_CERT_SUCCESS_CLEAR"}),SamsungSCloudSyncService.passwordService.connectSecureSuccess(data);break;case"REQUEST_GET_ALL_PASS":SamsungSCloudSyncService.passwordService.getCredentials({hostUrl:""},(result=>{if(200==result.code){const credentials=result.data.credentials&&result.data.credentials.length?result.data.credentials.map((credential=>new Credential(credential))):[];chrome.runtime.sendMessage({cmd:"RESPONSE_GET_ALL_PASS",data:{credentials:credentials,hasMoreCredentials:result.data.hasMoreCredentials}})}}),data)}return!0}))}SamsungSCloudSyncService.passwordBackgroundGlobal=null,PasswordBackground.prototype={isPasswordSyncEnable:()=>"DISABLED"!=storageLocalApi.getItem("PASSWORD_SYNC"),isAutoFillPasswordEnabled(){const result=SamsungSCloudSyncService.passwordService.status==PASS_APP_STATUS.SECURED&&isLoggedIn()&&"0"!=storageLocalApi.getItem("AUTOFILL_PASSWORD_ENABLED");return SamsungSCloudSyncService.PassLogs.log(`isAutoFillPasswordEnabled ${result}`),result},isSavePasswordEnabled(){const result=SamsungSCloudSyncService.passwordService.status==PASS_APP_STATUS.SECURED&&isLoggedIn()&&"0"!=storageLocalApi.getItem("SAVE_PASSWORD_ENABLED");return SamsungSCloudSyncService.passwordTabsGlobal.updateStatus(result),this.setChromePasswordSavingEnabled(!result),SamsungSCloudSyncService.PassLogs.log(`isSavePasswordEnabled ${result}`),result},onFindContentCredential(tabId,sender,data){SamsungSCloudSyncService.PassLogs.log("onFindContentCredential "+JSON.stringify(data)),SamsungSCloudSyncService.passwordTabsGlobal.tabs&&SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId]&&SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].updateFrame(sender,data),SamsungSCloudSyncService.passwordService.status!==PASS_APP_STATUS.SECURED&&(SamsungSCloudSyncService.passwordService.verifyByTabId=tabId,SamsungSCloudSyncService.passwordService.checkPassAppSignedIn())},setChromeAutofillEnabled(value){chrome.privacy.services.autofillEnabled.set({value:value},(()=>{void 0===chrome.runtime.lastError||chrome.runtime.lastError}))},setChromePasswordSavingEnabled(value){chrome.privacy.services.passwordSavingEnabled.get({},(result=>{result.value!=value&&chrome.privacy.services.passwordSavingEnabled.set({value:value})}))},sendCredentialToContent(tabId,data){SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId]&&data.origin&&chrome.tabs.sendMessage(tabId,{cmd:"GET_CREDENTIALS",filter:SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].curCredential.username,data:SamsungSCloudSyncService.passwordTabsGlobal.tabs[tabId].credentials})},setNerverSavePasswordNotice(url){SamsungSCloudSyncService.PassLogs.log("on set save credential for "+url);const origin=new URL(url).origin,currentNeverSavePasswordUrls=storageLocalApi.getItem("NEVER_SAVE_PASSWORD_URLS")?JSON.parse(storageLocalApi.getItem("NEVER_SAVE_PASSWORD_URLS")):[];currentNeverSavePasswordUrls.indexOf(origin)<0&&(currentNeverSavePasswordUrls.push(origin),storageLocalApi.setItem("NEVER_SAVE_PASSWORD_URLS",JSON.stringify(currentNeverSavePasswordUrls)))},isNerverSavePasswordNotice(url){SamsungSCloudSyncService.PassLogs.log("is never save credential for "+url);const origin=new URL(url).origin;return!((storageLocalApi.getItem("NEVER_SAVE_PASSWORD_URLS")?JSON.parse(storageLocalApi.getItem("NEVER_SAVE_PASSWORD_URLS")):[]).indexOf(origin)<0)},fillPassword(credential,tabId){SamsungSCloudSyncService.PassLogs.log("On fill credential calback, "+credential.username),chrome.tabs.sendMessage(tabId,{cmd:"FILL_CREDENTIAL",data:{username:credential.username,password:credential.password}})},onSaveCredentialCalback(result){SamsungSCloudSyncService.PassLogs.log("On save credential calback, "+JSON.stringify(result))},onUpdateCredentialCalback(result){SamsungSCloudSyncService.PassLogs.log("On update credential calback, "+JSON.stringify(result))}},SamsungSCloudSyncService.passwordBackgroundGlobal=new PasswordBackground;