let isFisrtDownload=!0;var errorInBookmarkSync;function showDownloadStatus(count,type){if(isLoggedIn()){const $bookmarks=document.getElementById("bookmarks");switch(type){case"key":const $status=document.querySelector(".noItemText.bookmark.syncing");if($status){const $span=$status.querySelector("span");$span?$span.innerHTML=`${count}`:count>0&&($status.innerHTML+=` (<span>${count}</span> ${ITEMS_TEXT.toLowerCase()})`)}$bookmarks.setAttribute("data-key-download-status",count),isFisrtDownload=!1;break;case"item":$bookmarks.classList.add("partial-load");const max=$bookmarks.dataset.keyDownloadStatus,percentage=Math.min(100,parseInt(100*parseInt(count)/parseInt(max))),oldPercentage=parseInt($bookmarks.dataset.downloadProgress||0),$progressBar=$bookmarks.querySelector(".download-progress");let currentPercentage=oldPercentage;$bookmarks.setAttribute("data-item-download-status",count);const interval=setInterval((async()=>{$progressBar.style.background=`linear-gradient(90deg, #0381FE ${currentPercentage<percentage?currentPercentage:percentage}%, #e3e0e0 0.01%)`,currentPercentage<percentage?(currentPercentage=Math.min(percentage,currentPercentage+1),await storageLocalApi.setItem(CURRENT_PROGRESS,currentPercentage),$bookmarks.setAttribute("data-download-progress",currentPercentage)):(clearInterval(interval),$bookmarks.setAttribute("data-download-progress",percentage))}),16)}}}async function insertError(flag){errorInBookmarkSync=document.getElementsByClassName("errorInBookmarkSync").length?document.getElementsByClassName("errorInBookmarkSync"):h("div",{class:"errorInBookmarkSync"},flag?INTERNET_FAILURE_TEXT:SYNC_ERROR);const $bookmarks=document.getElementById("bookmarks");$bookmarks.insertBefore(errorInBookmarkSync,$bookmarks.firstChild),errorInBookmarkSync.style.display="block",flag&&storageLocalApi.getItem(SYNC_STATUS)==SYNC_COMPLETED||await storageLocalApi.setItem(SYNC_STATUS,SYNC_COMPLETED)}async function triggerBackendSyncCompleteEvent(){await storageLocalApi.setItem(SYNC_STATUS,SYNC_COMPLETED)}function whenSyncStarts(){document.querySelector(".headerIcon");const $syncPage=document.querySelector(".syncPage"),$importButton=document.querySelector(".import-button"),$importText=document.querySelector(".bookmark-text-import");document.querySelector(".bookmark-manager").classList.add("sync"),$syncPage.classList.add("syncing"),$importButton&&$importButton.classList.add("syncing"),$importText&&$importText.classList.add("syncing"),AddToBookMarksButton.classList.add("syncing"),null!=errorInBookmarkSync&&(errorInBookmarkSync.style.display="none")}function cleanupSyncingStatus(){const[$bookmarks,$loaderIcon,$syncPage,$importButton,$importText,$bookmarkManagerIcon]=["#bookmarks",".headerIcon",".syncPage",".import-button",".bookmark-text-import",".bookmark-manager"].map((e=>document.querySelector(e)));["data-key-download-status","data-item-download-status","data-download-progress"].forEach((e=>$bookmarks.removeAttribute(e))),$bookmarkManagerIcon.classList.remove("sync"),$syncPage.classList.remove("syncing"),$importButton&&$importButton.classList.remove("syncing"),$importText&&$importText.classList.remove("syncing"),AddToBookMarksButton.classList.remove("syncing")}async function handleSyncEvents(SYNC){switch(SamsungSCloudSyncService.SyncLogs.log(SYNC),SYNC){case SYNC_STARTED:whenSyncStarts(),onLoad();break;case"BOOKMARK_SYNC_STARTED":case"TAB_SYNC_STARTED":whenSyncStarts();break;case SYNC_COMPLETED:await storageLocalApi.setArrayItems([[MAX_PROGRESS,0],[CURRENT_PROGRESS,0]]),triggerBackendSyncCompleteEvent(),cleanupSyncingStatus(),await storageLocalApi.setItem(LAST_SYNCED,Date.now()),document.getElementById("syncTime").className="settingText",document.getElementById("syncTime").innerText=stringifyLastImportTime(Date.now());break;case"TAB_SYNC_COMPLETED":await storageLocalApi.setArrayItems([[MAX_PROGRESS,0],[CURRENT_PROGRESS,0]]),triggerBackendSyncCompleteEvent(),cleanupSyncingStatus(),renderTabs(),await storageLocalApi.setItem(LAST_SYNCED,Date.now()),document.getElementById("syncTime").className="settingText",document.getElementById("syncTime").innerText=stringifyLastImportTime(Date.now());break;case"BOOKMARK_SYNC_COMPLETED":case"FIRST_BOOKMARK_SYNC_COMPLETED":await storageLocalApi.setArrayItems([[MAX_PROGRESS,0],[CURRENT_PROGRESS,0]]),triggerBackendSyncCompleteEvent(),cleanupSyncingStatus(),await storageLocalApi.setItem(LAST_SYNCED,Date.now()),document.getElementById("syncTime").className="settingText",document.getElementById("syncTime").innerText=stringifyLastImportTime(Date.now()),renderBookmarks();break;case"FIRST_SYNC_PARTIAL_LOAD":renderBookmarks({isPartial:!0})}}async function handleSyncErrors({ERROR:ERROR,CONNECTIVITY:CONNECTIVITY}){await storageLocalApi.setArrayItems([[MAX_PROGRESS,0],[CURRENT_PROGRESS,0]]),triggerBackendSyncCompleteEvent(),cleanupSyncingStatus(),document.getElementById("syncTime").className="settingFailureText",document.getElementById("syncTime").innerText=`${SYNC_FAIL}: ${ERROR||CONNECTIVITY}`,0==tabsyncDataContainer.childElementCount&&syncingTabText(NO_TABS),0==bookmarkDataContainer.childElementCount&&syncingBookmarkText(NO_BOOKMARKS),document.querySelector(".bookmark-manager").classList.remove("sync"),document.querySelector(".syncPage").classList.remove("syncing")}chrome.runtime.onMessage.addListener((response=>{const{ERROR:ERROR,CONNECTIVITY:CONNECTIVITY,CHROME_BOOKMARK_CHANGED:CHROME_BOOKMARK_CHANGED,ACCESS_TOKEN_URL_PROBLEM:ACCESS_TOKEN_URL_PROBLEM,SYNC:SYNC,USER_LOGGED_IN:USER_LOGGED_IN=!1,KEY_DOWNLOAD_STATUS:KEY_DOWNLOAD_STATUS=0,ITEM_DOWNLOAD_STATUS:ITEM_DOWNLOAD_STATUS=0}=response;if(console.log("%c Frontend Listener","color: brown;",response),ERROR||CONNECTIVITY)isLoggedIn()&&handleSyncErrors({ERROR:ERROR,CONNECTIVITY:CONNECTIVITY}),"Sync Timeout"===ERROR&&window.close();else if(CHROME_BOOKMARK_CHANGED)switchImportButton(!0);else switch(ACCESS_TOKEN_URL_PROBLEM){case"NETWORK_ERROR":showErrorMsg(LOGIN_EXP_ERROR);break;case"SESSION_EXPIRED":onLogoutClick();break;default:SYNC&&handleSyncEvents(SYNC)}KEY_DOWNLOAD_STATUS>0&&showDownloadStatus(KEY_DOWNLOAD_STATUS,"key"),isFisrtDownload&&(ITEM_DOWNLOAD_STATUS>0&&showDownloadStatus(storageLocalApi.getItem(MAX_PROGRESS),"key"),document.getElementById("bookmarks").setAttribute("data-download-progress",storageLocalApi.getItem(CURRENT_PROGRESS))),ITEM_DOWNLOAD_STATUS>0&&showDownloadStatus(ITEM_DOWNLOAD_STATUS,"item")}));